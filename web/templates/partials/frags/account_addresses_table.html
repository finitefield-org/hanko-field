{{ define "frag_account_addresses_table" }}
{{ $view := . }}
<div class="space-y-4">
  {{ if $view.Addresses }}
    <div class="overflow-x-auto rounded-2xl border border-gray-100">
      <table class="min-w-full divide-y divide-gray-100">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">{{ tlang $view.Lang "account.addresses.table.label" }}</th>
            <th scope="col" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">{{ tlang $view.Lang "account.addresses.table.address" }}</th>
            <th scope="col" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">{{ tlang $view.Lang "account.addresses.table.usage" }}</th>
            <th scope="col" class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-500">{{ tlang $view.Lang "account.addresses.table.updated" }}</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white">
          {{ range $addr := $view.Addresses }}
            <tr class="align-top text-sm text-gray-900">
              <td class="px-4 py-4">
                <div class="space-y-1">
                  <p class="font-semibold text-gray-900">{{ if $addr.Label }}{{ $addr.Label }}{{ else }}{{ $addr.Recipient }}{{ end }}</p>
                  <p class="text-xs text-gray-500">{{ $addr.Recipient }}{{ if $addr.Company }}, {{ $addr.Company }}{{ end }}{{ if $addr.Department }} · {{ $addr.Department }}{{ end }}</p>
                  <div class="flex flex-wrap gap-1.5 pt-1">
                    {{ if $addr.DefaultShipping }}
                      <span class="inline-flex items-center rounded-full bg-emerald-100 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-emerald-700">{{ tlang $view.Lang "account.addresses.badge.shipping" }}</span>
                    {{ end }}
                    {{ if $addr.DefaultBilling }}
                      <span class="inline-flex items-center rounded-full bg-amber-100 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-amber-800">{{ tlang $view.Lang "account.addresses.badge.billing" }}</span>
                    {{ end }}
                    {{ range $tag := $addr.Tags }}
                      <span class="inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide {{ if eq $tag.Tone "success" }}bg-emerald-50 text-emerald-700{{ else if eq $tag.Tone "warning" }}bg-amber-50 text-amber-800{{ else if eq $tag.Tone "info" }}bg-blue-50 text-blue-700{{ else if eq $tag.Tone "indigo" }}bg-indigo-50 text-indigo-700{{ else }}bg-gray-100 text-gray-600{{ end }}">{{ $tag.Label }}</span>
                    {{ end }}
                  </div>
                </div>
              </td>
              <td class="px-4 py-4 text-gray-700">
                <div class="space-y-1 text-sm leading-snug">
                  <p>{{ $addr.Line1 }}</p>
                  {{ if $addr.Line2 }}<p>{{ $addr.Line2 }}</p>{{ end }}
                  <p>{{ if $addr.PostalCode }}{{ $addr.PostalCode }} {{ end }}{{ $addr.City }}, {{ $addr.Region }}</p>
                  <p>{{ $addr.CountryLabel }}</p>
                  {{ if $addr.Instructions }}<p class="text-xs text-gray-500">{{ $addr.Instructions }}</p>{{ end }}
                  {{ if $addr.Phone }}<p class="text-xs text-gray-500">{{ $addr.Phone }}</p>{{ end }}
                </div>
              </td>
              <td class="px-4 py-4">
                <div class="space-y-2 text-sm text-gray-700">
                  <p class="font-medium">{{ if eq $addr.Kind "billing" }}{{ tlang $view.Lang "account.addresses.kind.billing" }}{{ else if eq $addr.Kind "both" }}{{ tlang $view.Lang "account.addresses.kind.both" }}{{ else }}{{ tlang $view.Lang "account.addresses.kind.shipping" }}{{ end }}</p>
                  <p class="text-xs text-gray-500">{{ if not ($addr.UpdatedAt.IsZero) }}{{ fmtDate $addr.UpdatedAt $view.Lang }}{{ end }}</p>
                </div>
              </td>
              <td class="px-4 py-4 text-right">
                <div class="relative inline-block text-left" data-address-menu>
                  <button type="button"
                          class="inline-flex items-center justify-center rounded-full p-2 text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                          aria-haspopup="true"
                          aria-expanded="false"
                          data-address-menu-trigger>
                    <span class="sr-only">{{ if eq $view.Lang "ja" }}操作メニュー{{ else }}Open menu{{ end }}</span>
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="5" r="1"/>
                      <circle cx="12" cy="12" r="1"/>
                      <circle cx="12" cy="19" r="1"/>
                    </svg>
                  </button>
                  <div class="absolute right-0 z-20 mt-2 w-40 origin-top-right rounded-xl border border-gray-100 bg-white p-2 text-sm shadow-xl focus:outline-none hidden"
                       role="menu"
                       data-address-menu-panel>
                    {{ if $addr.Editable }}
                      <button type="button"
                              class="flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left text-gray-700 hover:bg-gray-50"
                              hx-get="/account/addresses/modal?id={{ $addr.ID }}&kind={{ $addr.Kind }}"
                              hx-target="#modal-root"
                              hx-swap="innerHTML">
                        {{ template "icon" (dict "Name" "wrench-screwdriver" "Class" "h-4 w-4 text-gray-500") }}
                        {{ tlang $view.Lang "account.addresses.actions.edit" }}
                      </button>
                    {{ end }}
                    {{ if and $view.SessionAddressIDs (index $view.SessionAddressIDs $addr.ID) }}
                      <button type="button"
                              class="mt-1 flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left text-rose-600 hover:bg-rose-50"
                              hx-delete="/me/addresses/{{ $addr.ID }}"
                              hx-confirm="{{ tlang $view.Lang "account.addresses.actions.confirm" }}"
                              hx-target="closest tr"
                              hx-swap="none">
                        {{ template "icon" (dict "Name" "trash" "Class" "h-4 w-4 text-rose-500") }}
                        {{ tlang $view.Lang "account.addresses.actions.delete" }}
                      </button>
                    {{ end }}
                  </div>
                </div>
              </td>
            </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
  {{ else }}
    <div class="flex flex-col items-center justify-center gap-4 rounded-2xl border border-dashed border-gray-200 bg-gray-50 px-6 py-12 text-center">
      <div class="rounded-full bg-indigo-100 p-3 text-indigo-600">
        {{ template "icon" (dict "Name" "map-pin" "Class" "h-6 w-6") }}
      </div>
      <div class="space-y-1">
        <p class="text-lg font-semibold text-gray-900">{{ $view.EmptyTitle }}</p>
        <p class="text-sm text-gray-600">{{ $view.EmptyBody }}</p>
      </div>
      <button type="button"
              class="inline-flex items-center justify-center rounded-xl bg-indigo-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-indigo-500"
              hx-get="{{ $view.ModalURL }}"
              hx-target="#modal-root"
              hx-swap="innerHTML">
        {{ $view.EmptyActionLabel }}
      </button>
    </div>
  {{ end }}
  <p class="text-xs text-gray-500">{{ tlang $view.Lang "account.addresses.last_synced" }} · {{ fmtDate $view.LastSynced $view.Lang }}</p>
</div>
{{ end }}
