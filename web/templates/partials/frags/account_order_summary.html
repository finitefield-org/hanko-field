{{ define "frag_account_order_summary" }}
{{ $view := . }}
<div class="space-y-6">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <div>
      <p class="text-sm font-semibold text-gray-900">{{ if eq $view.Lang "ja" }}注文概要{{ else }}Order overview{{ end }}</p>
      <p class="text-xs text-gray-500">{{ if eq $view.Lang "ja" }}注文番号{{ else }}Order number{{ end }}: {{ $view.OrderNumber }}</p>
    </div>
    <a href="{{ $view.ReorderHref }}" class="inline-flex items-center gap-2 rounded-xl border border-indigo-200 bg-white px-4 py-2 text-xs font-semibold text-indigo-700 shadow-sm transition hover:bg-indigo-50">
      {{ if eq $view.Lang "ja" }}再注文を開始{{ else }}Start reorder{{ end }}
      {{ template "icon" (dict "Name" "arrow-path" "Class" "h-4 w-4") }}
    </a>
  </div>

  <div class="grid gap-4 lg:grid-cols-2">
    {{ range $card := list (dict "Data" $view.Shipping) (dict "Data" $view.Billing) }}
      {{ $data := $card.Data }}
      <section class="space-y-3 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
        <header class="flex items-center justify-between gap-3">
          <div>
            <p class="text-xs font-semibold uppercase tracking-wide text-gray-500">{{ $data.Title }}</p>
            <p class="text-sm font-semibold text-gray-900">{{ $data.Name }}</p>
            <p class="text-xs text-gray-500">{{ $data.Company }}</p>
          </div>
        </header>
        <div class="space-y-2 text-sm text-gray-600">
          {{ range $line := $data.Lines }}
            <p>{{ $line }}</p>
          {{ end }}
        </div>
        <div class="space-y-1 text-xs text-gray-500">
          {{ if $data.Phone }}<p>{{ if eq $view.Lang "ja" }}電話{{ else }}Phone{{ end }}: {{ $data.Phone }}</p>{{ end }}
          {{ if $data.Email }}<p>Email: {{ $data.Email }}</p>{{ end }}
        </div>
        {{ if $data.Notes }}
          <ul class="space-y-1 rounded-xl bg-indigo-50/70 p-3 text-xs text-indigo-900">
            {{ range $note := $data.Notes }}
              <li class="flex gap-2">
                <span class="mt-1 h-1.5 w-1.5 flex-none rounded-full bg-indigo-500"></span>
                <span>{{ $note }}</span>
              </li>
            {{ end }}
          </ul>
        {{ end }}
      </section>
    {{ end }}
  </div>

  <section class="space-y-4 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
    <header class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <h3 class="text-sm font-semibold text-gray-900">{{ if eq $view.Lang "ja" }}注文アイテム{{ else }}Line items{{ end }}</h3>
        <p class="text-xs text-gray-500">{{ if eq $view.Lang "ja" }}現状ステータスと予定を確認{{ else }}Current production stages and ETAs{{ end }}</p>
      </div>
      <span class="inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-xs text-gray-600">
        {{ len $view.Items }} {{ if eq $view.Lang "ja" }}件{{ else }}items{{ end }}
      </span>
    </header>
    <div class="overflow-hidden rounded-xl border border-gray-100">
      <table class="min-w-full divide-y divide-gray-100">
        <thead class="bg-gray-50">
          <tr>
            {{ $heads := list (dict "Label" "Item") (dict "Label" "SKU") (dict "Label" "Qty") (dict "Label" "Stage") (dict "Label" "Amount") }}
            {{ if eq $view.Lang "ja" }}{{ $heads = list (dict "Label" "アイテム") (dict "Label" "SKU") (dict "Label" "数量") (dict "Label" "進捗") (dict "Label" "金額") }}{{ end }}
            {{ range $head := $heads }}
              <th scope="col" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">{{ $head.Label }}</th>
            {{ end }}
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white text-sm text-gray-700">
          {{ range $item := $view.Items }}
            {{ $stageBadge := "bg-gray-100 text-gray-600" }}
            {{ if eq $item.StageTone "success" }}{{ $stageBadge = "bg-emerald-100 text-emerald-700" }}{{ else if eq $item.StageTone "info" }}{{ $stageBadge = "bg-sky-100 text-sky-700" }}{{ else if eq $item.StageTone "danger" }}{{ $stageBadge = "bg-rose-100 text-rose-700" }}{{ else if eq $item.StageTone "indigo" }}{{ $stageBadge = "bg-indigo-100 text-indigo-700" }}{{ end }}
            <tr class="align-top">
              <td class="px-4 py-4">
                <p class="font-semibold text-gray-900">{{ $item.Name }}</p>
                {{ if $item.Attributes }}
                  <ul class="mt-1 space-y-0.5 text-xs text-gray-500">
                    {{ range $attr := $item.Attributes }}
                      <li>{{ $attr }}</li>
                    {{ end }}
                  </ul>
                {{ end }}
              </td>
              <td class="px-4 py-4 text-xs text-gray-500">{{ $item.SKU }}</td>
              <td class="px-4 py-4 text-sm font-semibold text-gray-900">{{ $item.Quantity }}</td>
              <td class="px-4 py-4">
                <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-wide {{ $stageBadge }}">{{ $item.StageLabel }}</span>
                <p class="mt-1 text-xs text-gray-500">{{ if $item.DeliveryETA }}{{ if eq $view.Lang "ja" }}予定:{{ else }}ETA{{ end }} {{ fmtDate $item.DeliveryETA $view.Lang }}{{ end }}</p>
              </td>
              <td class="px-4 py-4 text-sm font-semibold text-gray-900">{{ fmtMoney $item.Total $view.Totals.Currency $view.Lang }}</td>
            </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
  </section>

  <div class="grid gap-4 lg:grid-cols-[minmax(0,1fr)_280px]">
    <section class="space-y-4 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
      <header>
        <h3 class="text-sm font-semibold text-gray-900">{{ if eq $view.Lang "ja" }}関係者{{ else }}Stakeholders{{ end }}</h3>
      </header>
      <ul class="space-y-3">
        {{ range $contact := $view.Contacts }}
          <li class="rounded-2xl border border-gray-100 bg-gray-50 px-4 py-3 text-sm text-gray-700">
            <p class="flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-gray-500">
              <span>{{ $contact.Role }}</span>
              <span>{{ $contact.Status }}</span>
            </p>
            <p class="mt-1 text-sm font-semibold text-gray-900">{{ $contact.Name }}</p>
            {{ if $contact.Email }}<p class="text-xs text-gray-500">{{ $contact.Email }}</p>{{ end }}
            {{ if $contact.Phone }}<p class="text-xs text-gray-500">{{ $contact.Phone }}</p>{{ end }}
          </li>
        {{ end }}
      </ul>
      {{ if $view.Notes }}
        <div class="space-y-3">
          <h4 class="text-xs font-semibold uppercase tracking-wide text-gray-500">{{ if eq $view.Lang "ja" }}メモ{{ else }}Notes{{ end }}</h4>
          <ul class="space-y-3">
            {{ range $note := $view.Notes }}
              <li class="rounded-2xl border border-indigo-100 bg-indigo-50/60 p-3 text-sm text-indigo-900">
                <p class="text-xs font-semibold uppercase tracking-wide">{{ $note.Title }}</p>
                <p class="mt-1 text-sm text-indigo-900">{{ $note.Body }}</p>
                <p class="mt-2 text-xs text-indigo-700">{{ fmtDate $note.Timestamp $view.Lang }} · {{ $note.Author }}</p>
              </li>
            {{ end }}
          </ul>
        </div>
      {{ end }}
    </section>

    <aside class="space-y-4 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
      <header>
        <h3 class="text-sm font-semibold text-gray-900">{{ if eq $view.Lang "ja" }}請求サマリー{{ else }}Billing summary{{ end }}</h3>
        <p class="text-xs text-gray-500">{{ if eq $view.Lang "ja" }}残額{{ else }}Balance{{ end }}: {{ $view.Totals.FormattedDue }}</p>
      </header>
      <dl class="space-y-2 text-sm text-gray-700">
        <div class="flex items-center justify-between">
          <dt>{{ if eq $view.Lang "ja" }}小計{{ else }}Subtotal{{ end }}</dt>
          <dd class="font-semibold">{{ fmtMoney $view.Totals.Subtotal $view.Totals.Currency $view.Lang }}</dd>
        </div>
        <div class="flex items-center justify-between">
          <dt>{{ if eq $view.Lang "ja" }}送料{{ else }}Shipping{{ end }}</dt>
          <dd class="font-semibold">{{ fmtMoney $view.Totals.Shipping $view.Totals.Currency $view.Lang }}</dd>
        </div>
        <div class="flex items-center justify-between">
          <dt>{{ if eq $view.Lang "ja" }}税金{{ else }}Taxes{{ end }}</dt>
          <dd class="font-semibold">{{ fmtMoney $view.Totals.Taxes $view.Totals.Currency $view.Lang }}</dd>
        </div>
        <div class="flex items-center justify-between">
          <dt>{{ if eq $view.Lang "ja" }}手数料{{ else }}Fees{{ end }}</dt>
          <dd class="font-semibold">{{ fmtMoney $view.Totals.Fees $view.Totals.Currency $view.Lang }}</dd>
        </div>
        <div class="flex items-center justify-between text-emerald-600">
          <dt>{{ if eq $view.Lang "ja" }}割引{{ else }}Discounts{{ end }}</dt>
          <dd class="font-semibold">{{ fmtMoney $view.Totals.Discounts $view.Totals.Currency $view.Lang }}</dd>
        </div>
        <div class="flex items-center justify-between border-t border-gray-100 pt-2 text-sm font-semibold text-gray-900">
          <dt>{{ if eq $view.Lang "ja" }}合計{{ else }}Total{{ end }}</dt>
          <dd>{{ fmtMoney $view.Totals.GrandTotal $view.Totals.Currency $view.Lang }}</dd>
        </div>
      </dl>
    </aside>
  </div>
</div>
{{ end }}
