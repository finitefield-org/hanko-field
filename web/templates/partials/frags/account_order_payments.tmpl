{{ define "frag_account_order_payments" }}
{{ $view := . }}
<div class="space-y-6 p-5">
  <section class="space-y-3 rounded-2xl border border-indigo-100 bg-indigo-50/70 p-4 text-indigo-900">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <p class="text-xs font-semibold uppercase tracking-wide">{{ if eq $view.Lang "ja" }}支払い方法{{ else }}Payment method{{ end }}</p>
        <p class="text-sm font-semibold">{{ $view.Method.Label }}</p>
        <p class="text-xs opacity-80">{{ $view.Method.Details }}</p>
      </div>
      <div class="text-right text-xs">
        <p class="font-semibold">{{ $view.Method.Status }}</p>
        <p class="opacity-80">{{ if eq $view.Lang "ja" }}更新{{ else }}Updated{{ end }} {{ fmtDate $view.Method.UpdatedAt $view.Lang }}</p>
        {{ if $view.Method.Autopay }}
          <span class="mt-1 inline-flex items-center gap-1 rounded-full bg-indigo-600 px-3 py-1 text-[11px] font-semibold text-white">
            {{ template "icon" (dict "Name" "bolt" "Class" "h-4 w-4") }}
            {{ if eq $view.Lang "ja" }}自動決済{{ else }}Autopay enabled{{ end }}
          </span>
        {{ end }}
      </div>
    </div>
  </section>

  <div class="grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]">
    <section class="space-y-4 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
      <header class="flex flex-wrap items-center justify-between gap-3">
        <div>
          <h3 class="text-sm font-semibold text-gray-900">{{ if eq $view.Lang "ja" }}決済履歴{{ else }}Charge history{{ end }}</h3>
          <p class="text-xs text-gray-500">{{ if eq $view.Lang "ja" }}入金と返金の記録{{ else }}Captured payments and adjustments{{ end }}</p>
        </div>
        <span class="inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-xs text-gray-600">
          {{ len $view.Charges }} {{ if eq $view.Lang "ja" }}件{{ else }}entries{{ end }}
        </span>
      </header>
      <div class="overflow-hidden rounded-xl border border-gray-100">
        <table class="min-w-full divide-y divide-gray-100 text-sm text-gray-700">
          <thead class="bg-gray-50">
            <tr>
              {{ $heads := list "Date" "ID" "Amount" "Status" "Note" }}
              {{ if eq $view.Lang "ja" }}{{ $heads = list "日付" "ID" "金額" "状態" "メモ" }}{{ end }}
              {{ range $head := $heads }}
                <th scope="col" class="px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-gray-500">{{ $head }}</th>
              {{ end }}
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100 bg-white">
            {{ range $charge := $view.Charges }}
              {{ $tone := "bg-gray-100 text-gray-600" }}
              {{ if eq $charge.StatusTone "success" }}{{ $tone = "bg-emerald-100 text-emerald-700" }}{{ else if eq $charge.StatusTone "info" }}{{ $tone = "bg-sky-100 text-sky-700" }}{{ else if eq $charge.StatusTone "danger" }}{{ $tone = "bg-rose-100 text-rose-700" }}{{ end }}
              <tr>
                <td class="px-4 py-4 text-xs text-gray-500">{{ fmtDate $charge.CreatedAt $view.Lang }}</td>
                <td class="px-4 py-4 text-xs font-mono text-gray-600">{{ $charge.ID }}</td>
                <td class="px-4 py-4 text-sm font-semibold text-gray-900">{{ fmtMoney $charge.Amount $charge.Currency $view.Lang }}</td>
                <td class="px-4 py-4">
                  <span class="inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold uppercase tracking-wide {{ $tone }}">{{ $charge.StatusLabel }}</span>
                  <p class="mt-1 text-xs text-gray-500">{{ $charge.Method }}</p>
                </td>
                <td class="px-4 py-4 text-xs text-gray-500">
                  {{ $charge.Note }}
                  {{ if $charge.ReceiptURL }}
                    <a href="{{ $charge.ReceiptURL }}" class="mt-1 inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-500">
                      {{ template "icon" (dict "Name" "arrow-top-right-on-square" "Class" "h-3 w-3") }}
                      {{ if eq $view.Lang "ja" }}レシート{{ else }}Receipt{{ end }}
                    </a>
                  {{ end }}
                </td>
              </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
    </section>

    <aside class="space-y-4 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
      <div>
        <h3 class="text-sm font-semibold text-gray-900">{{ if eq $view.Lang "ja" }}今後のスケジュール{{ else }}Upcoming schedule{{ end }}</h3>
        <ul class="mt-3 space-y-2 text-sm text-gray-700">
          {{ range $term := $view.Upcoming }}
            <li class="rounded-xl border border-gray-100 bg-gray-50 px-4 py-3">
              <p class="text-xs font-semibold uppercase tracking-wide text-gray-500">{{ $term.Label }}</p>
              <p class="text-sm font-semibold text-gray-900">{{ fmtMoney $term.Amount $term.Currency $view.Lang }}</p>
              <p class="text-xs text-gray-500">{{ fmtDate $term.DueDate $view.Lang }} · {{ $term.Status }}</p>
            </li>
          {{ end }}
        </ul>
      </div>
      {{ if $view.Adjustments }}
        <div>
          <h4 class="text-xs font-semibold uppercase tracking-wide text-gray-500">{{ if eq $view.Lang "ja" }}調整{{ else }}Adjustments{{ end }}</h4>
          <ul class="mt-2 space-y-2 text-xs text-gray-600">
            {{ range $adj := $view.Adjustments }}
              <li class="rounded-lg bg-indigo-50/70 px-3 py-2 text-indigo-900">
                <div class="flex items-center justify-between">
                  <span class="font-semibold">{{ $adj.Label }}</span>
                  <span class="font-semibold">{{ fmtMoney $adj.Amount $adj.Currency $view.Lang }}</span>
                </div>
                <p class="mt-1 text-[11px] opacity-80">{{ $adj.Reason }}</p>
              </li>
            {{ end }}
          </ul>
        </div>
      {{ end }}
      <div class="rounded-xl border border-indigo-200 bg-indigo-50/70 px-4 py-3 text-sm text-indigo-900">
        <p class="text-xs font-semibold uppercase tracking-wide">{{ if eq $view.Lang "ja" }}未収残高{{ else }}Outstanding balance{{ end }}</p>
        <p class="text-lg font-semibold">{{ fmtMoney $view.BalanceDue $view.Currency $view.Lang }}</p>
        <p class="text-xs opacity-80">{{ if eq $view.Lang "ja" }}最終更新{{ else }}Last updated{{ end }} {{ fmtDate $view.LastUpdated $view.Lang }}</p>
      </div>
    </aside>
  </div>
</div>
{{ end }}
