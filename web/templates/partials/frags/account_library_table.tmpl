{{ define "frag_account_library_table" }}
{{ $view := . }}
<div class="space-y-5" data-library-grid data-total="{{ $view.Total }}" data-page="{{ $view.Page }}">
  <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <p class="text-sm font-semibold text-gray-800">{{ $view.ResultLabel }}</p>
    <p class="text-xs text-gray-400">
      {{ if eq $view.Lang "ja" }}最終更新{{ else }}Last refreshed{{ end }} · {{ fmtDate $view.LastUpdated $view.Lang }}
    </p>
  </div>

  <div data-library-bulk class="rounded-2xl border border-indigo-200 bg-indigo-50/70 px-4 py-3 text-sm text-indigo-900 {{ if not $view.Bulk.Active }}hidden{{ end }}">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <p class="font-semibold">{{ $view.Bulk.Label }}</p>
      <div class="flex flex-wrap gap-2">
        {{ range $action := $view.Bulk.Actions }}
          {{ $variant := $action.Variant }}
          {{ $classes := "inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-xs font-semibold transition" }}
          {{ if eq $variant "primary" }}
            {{ $classes = printf "%s bg-indigo-600 text-white hover:bg-indigo-500" $classes }}
          {{ else if eq $variant "secondary" }}
            {{ $classes = printf "%s border border-indigo-200 bg-white text-indigo-700 hover:border-indigo-300" $classes }}
          {{ else if eq $variant "danger" }}
            {{ $classes = printf "%s border border-rose-200 bg-rose-50 text-rose-700 hover:bg-rose-100" $classes }}
          {{ else }}
            {{ $classes = printf "%s border border-gray-200 bg-white text-gray-700 hover:border-indigo-200" $classes }}
          {{ end }}
          <button type="button"
                  class="{{ $classes }}"
                  hx-post="{{ $action.Href }}"
                  hx-include="#account-library-selections"
                  hx-target="closest [data-library-bulk]"
                  hx-swap="none"
                  {{ if $action.Confirm }}hx-confirm="{{ $action.Confirm }}"{{ end }}
                  data-library-bulk-action>
            {{ template "icon" (dict "Name" $action.Icon "Class" "h-4 w-4") }}
            <span>{{ $action.Label }}</span>
          </button>
        {{ end }}
      </div>
    </div>
  </div>

  {{ if $view.Items }}
    <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
      {{ range $card := $view.Items }}
        {{ $statusTone := $card.StatusTone }}
        {{ $statusBadge := "bg-slate-100 text-slate-700" }}
        {{ if eq $statusTone "success" }}{{ $statusBadge = "bg-emerald-100 text-emerald-700" }}{{ else if eq $statusTone "warning" }}{{ $statusBadge = "bg-amber-100 text-amber-700" }}{{ else if eq $statusTone "danger" }}{{ $statusBadge = "bg-rose-100 text-rose-700" }}{{ else if eq $statusTone "indigo" }}{{ $statusBadge = "bg-indigo-100 text-indigo-700" }}{{ end }}
        {{ $regTone := $card.RegistrabilityTone }}
        {{ $regBadge := "text-slate-600" }}
        {{ if eq $regTone "success" }}{{ $regBadge = "text-emerald-600" }}{{ else if eq $regTone "warning" }}{{ $regBadge = "text-amber-600" }}{{ end }}
        <article data-library-card="{{ $card.ID }}"
                 data-selected="{{ if $card.Selected }}true{{ else }}false{{ end }}"
                 class="relative flex h-full flex-col overflow-hidden rounded-3xl border border-gray-200 bg-white shadow-sm transition data-[selected=true]:border-indigo-300 data-[selected=true]:ring-2 data-[selected=true]:ring-indigo-200">
          <button type="button"
                  data-library-select
                  class="absolute right-3 top-3 inline-flex items-center justify-center rounded-full border border-gray-200 bg-white/90 p-2 shadow-sm transition hover:border-indigo-300 hover:text-indigo-600"
                  aria-label="{{ if eq $view.Lang "ja" }}選択を切り替え{{ else }}Toggle selection{{ end }}">
            <input type="checkbox"
                   class="pointer-events-none h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                   data-library-select-indicator
                   {{ if $card.Selected }}checked{{ end }}>
          </button>
          <div class="relative bg-gray-50">
            <img src="{{ $card.Thumbnail }}" alt="{{ $card.ThumbnailAlt }}" class="h-48 w-full object-cover" loading="lazy" decoding="async" srcset="{{ responsiveSrcset $card.Thumbnail }}" sizes="{{ responsiveSizes "card" }}">
            <div class="absolute left-4 top-4 inline-flex items-center gap-2">
              <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-wide {{ $statusBadge }}">{{ $card.StatusLabel }}</span>
              <span class="text-xs font-semibold {{ $regBadge }}">{{ $card.RegistrabilityLabel }}</span>
            </div>
          </div>
          <div class="flex flex-1 flex-col gap-4 p-5">
            <header class="space-y-2">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <h3 class="text-base font-semibold text-gray-900">{{ $card.Name }}</h3>
                  <p class="text-xs text-gray-500">{{ $card.TemplateName }}</p>
                </div>
                <span class="text-xs font-semibold text-indigo-600">{{ $card.AIScoreLabel }}</span>
              </div>
              <p class="text-sm text-gray-600">{{ $card.Description }}</p>
              <ul class="flex flex-wrap gap-2 text-xs text-gray-500">
                {{ range $meta := $card.Meta }}
                  <li class="inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1">{{ $meta }}</li>
                {{ end }}
              </ul>
            </header>
            <div class="flex flex-wrap gap-2">
              {{ range $tag := $card.Tags }}
                {{ $tagTone := $tag.Tone }}
                {{ $tagClass := "bg-slate-100 text-slate-700" }}
                {{ if eq $tagTone "indigo" }}{{ $tagClass = "bg-indigo-100 text-indigo-700" }}{{ else if eq $tagTone "violet" }}{{ $tagClass = "bg-violet-100 text-violet-700" }}{{ else if eq $tagTone "emerald" }}{{ $tagClass = "bg-emerald-100 text-emerald-700" }}{{ else if eq $tagTone "sky" }}{{ $tagClass = "bg-sky-100 text-sky-700" }}{{ else if eq $tagTone "amber" }}{{ $tagClass = "bg-amber-100 text-amber-700" }}{{ else if eq $tagTone "rose" }}{{ $tagClass = "bg-rose-100 text-rose-700" }}{{ else if eq $tagTone "cyan" }}{{ $tagClass = "bg-cyan-100 text-cyan-700" }}{{ else if eq $tagTone "purple" }}{{ $tagClass = "bg-purple-100 text-purple-700" }}{{ end }}
                <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium {{ $tagClass }}">{{ $tag.Label }}</span>
              {{ end }}
            </div>
            <div class="mt-auto space-y-3">
              <div class="flex items-center justify-between text-xs text-gray-500">
                <span>{{ if eq $view.Lang "ja" }}更新{{ else }}Updated{{ end }} · {{ $card.UpdatedRelative }}</span>
                <span>{{ $card.OwnerName }}</span>
              </div>
              <div class="flex flex-wrap gap-2">
                <button type="button"
                        class="inline-flex flex-1 items-center justify-center gap-2 rounded-xl border border-gray-200 px-3 py-2 text-xs font-semibold text-gray-700 transition hover:border-indigo-300 hover:text-indigo-600"
                        hx-post="{{ $card.DuplicateAction.Href }}"
                        hx-include="#account-library-selections"
                        hx-target="closest [data-library-card]"
                        hx-swap="none">
                  {{ template "icon" (dict "Name" $card.DuplicateAction.Icon "Class" "h-4 w-4") }}
                  <span>{{ $card.DuplicateAction.Label }}</span>
                </button>
                <button type="button"
                        class="inline-flex flex-1 items-center justify-center gap-2 rounded-xl border border-gray-200 px-3 py-2 text-xs font-semibold text-gray-700 transition hover:border-indigo-300 hover:text-indigo-600"
                        hx-post="{{ $card.ExportAction.Href }}"
                        hx-include="#account-library-selections"
                        hx-target="closest [data-library-card]"
                        hx-swap="none">
                  {{ template "icon" (dict "Name" $card.ExportAction.Icon "Class" "h-4 w-4") }}
                  <span>{{ $card.ExportAction.Label }}</span>
                </button>
                <button type="button"
                        class="inline-flex items-center justify-center gap-2 rounded-xl border border-gray-200 px-3 py-2 text-xs font-semibold text-gray-700 transition hover:border-indigo-300 hover:text-indigo-600"
                        hx-get="{{ $card.ShareAction.Href }}"
                        hx-target="#modal"
                        hx-swap="innerHTML">
                  {{ template "icon" (dict "Name" $card.ShareAction.Icon "Class" "h-4 w-4") }}
                  <span>{{ $card.ShareAction.Label }}</span>
                </button>
                <a href="{{ $card.DetailHref }}"
                   class="inline-flex items-center justify-center gap-1 rounded-xl bg-indigo-600 px-3 py-2 text-xs font-semibold text-white shadow-sm transition hover:bg-indigo-500"
                   data-library-detail
                   hx-get="{{ $card.DetailHref }}"
                   hx-target="#account-library-drawer"
                   hx-swap="innerHTML"
                   hx-push-url="true"
                   hx-include="#account-library-filters,#account-library-selections">
                  {{ if eq $view.Lang "ja" }}詳細{{ else }}Details{{ end }}
                  {{ template "icon" (dict "Name" "arrow-right" "Class" "h-4 w-4") }}
                </a>
              </div>
            </div>
          </div>
        </article>
      {{ end }}
    </div>
  {{ else }}
    <div class="flex flex-col items-center justify-center gap-4 rounded-2xl border border-dashed border-gray-200 bg-gray-50 px-6 py-12 text-center">
      <div class="rounded-full bg-indigo-100 p-3 text-indigo-600">
        {{ template "icon" (dict "Name" "document-duplicate" "Class" "h-6 w-6") }}
      </div>
      <div class="space-y-1">
        <p class="text-lg font-semibold text-gray-900">{{ if eq $view.Lang "ja" }}デザインが見つかりません{{ else }}No designs yet{{ end }}</p>
        <p class="text-sm text-gray-600">{{ if eq $view.Lang "ja" }}フィルタ条件を変更するか、新しく作成してください。{{ else }}Adjust your filters or create a new seal to get started.{{ end }}</p>
      </div>
      <a href="/design/new"
         class="inline-flex items-center justify-center rounded-xl bg-indigo-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-indigo-500">
        {{ if eq $view.Lang "ja" }}新しいデザインを作成{{ else }}Create a design{{ end }}
      </a>
    </div>
  {{ end }}

  <div class="flex items-center justify-between text-xs text-gray-500">
    <span>
      {{ if eq $view.Lang "ja" }}
        {{ if gt $view.Showing 0 }}{{ $view.Showing }} / {{ $view.Total }} 件{{ else }}0 件{{ end }}
      {{ else }}
        {{ if gt $view.Showing 0 }}Showing {{ $view.Showing }} of {{ $view.Total }} designs{{ else }}No designs{{ end }}
      {{ end }}
    </span>
    {{ if $view.HasMore }}
      <button type="button"
              class="inline-flex items-center gap-2 rounded-xl border border-gray-200 px-4 py-2 text-sm font-semibold text-gray-700 transition hover:border-indigo-300 hover:text-indigo-600"
              data-library-load-more="{{ $view.NextPage }}">
        {{ if eq $view.Lang "ja" }}さらに読み込む{{ else }}Load more{{ end }}
        {{ template "icon" (dict "Name" "arrow-down" "Class" "h-4 w-4") }}
      </button>
    {{ else }}
      <span class="text-xs text-gray-400">{{ if eq $view.Lang "ja" }}すべて表示しました{{ else }}All results loaded{{ end }}</span>
    {{ end }}
  </div>
</div>
{{ end }}
