{{ define "content" }}
{{ $view := . }}
<section class="mx-auto max-w-4xl space-y-10">
  <div class="overflow-hidden rounded-3xl border border-indigo-100 bg-white shadow-lg">
    <div class="grid gap-8 p-8 lg:grid-cols-[minmax(0,3fr),minmax(0,2fr)] lg:p-12">
      <div class="space-y-6">
        <div class="flex items-center gap-4">
          <span class="inline-flex h-12 w-12 flex-none items-center justify-center rounded-2xl bg-indigo-50 text-indigo-600">
            {{ template "icon" (dict "Name" "link-slash" "Class" "h-6 w-6") }}
          </span>
          <div>
            <h1 class="text-2xl font-semibold text-gray-900">{{ if $view.Heading }}{{ $view.Heading }}{{ else }}{{ tlang $.Lang "offline.title" }}{{ end }}</h1>
            <p class="mt-1 text-sm text-gray-500">{{ if $view.Message }}{{ $view.Message }}{{ else }}{{ tlang $.Lang "offline.subtitle" }}{{ end }}</p>
          </div>
        </div>
        <div class="rounded-2xl border border-dashed border-gray-200 bg-gray-50/70 p-6">
          <dl class="space-y-3 text-sm text-gray-600">
            <div class="flex items-center justify-between gap-4">
              <dt class="font-medium text-gray-700">{{ tlang $.Lang "offline.sync" }}</dt>
              <dd class="flex items-center gap-2 text-xs">
                <span class="inline-flex h-2 w-2 rounded-full bg-red-400" aria-hidden="true"></span>
                <span>{{ if $view.LastSynced }}{{ $view.LastSynced }}{{ else }}{{ tlang $.Lang "offline.unsynced" }}{{ end }}</span>
              </dd>
            </div>
            <div class="flex items-center justify-between gap-4">
              <dt class="font-medium text-gray-700">{{ tlang $.Lang "offline.status" }}</dt>
              <dd class="flex items-center gap-2 text-xs font-semibold text-gray-500">
                <span class="inline-flex h-2 w-2 rounded-full bg-orange-300" aria-hidden="true"></span>
                <span>{{ tlang $.Lang "offline.status.down" }}</span>
              </dd>
            </div>
          </dl>
          {{ if $view.RetryAction.Href }}
            <div class="mt-6">
              <a href="{{ $view.RetryAction.Href }}" class="inline-flex items-center gap-2 rounded-full bg-indigo-600 px-5 py-2 text-sm font-semibold text-white shadow transition hover:bg-indigo-500 focus-visible:outline-none focus-visible:ring focus-visible:ring-indigo-500/50">
                {{ if $view.RetryAction.Icon }}{{ template "icon" (dict "Name" $view.RetryAction.Icon "Class" "h-4 w-4") }}{{ else }}{{ template "icon" (dict "Name" "arrow-path" "Class" "h-4 w-4") }}{{ end }}
                <span>{{ if $view.RetryAction.Label }}{{ $view.RetryAction.Label }}{{ else }}{{ tlang $.Lang "offline.retry" }}{{ end }}</span>
              </a>
            </div>
          {{ end }}
        </div>
      </div>
      <div class="relative isolate">
        <div class="absolute inset-0 -z-10 bg-gradient-to-br from-indigo-50 via-white to-indigo-100"></div>
        <div class="rounded-3xl border border-indigo-100 bg-white/90 p-6 shadow-inner">
          <h2 class="text-sm font-semibold uppercase tracking-[0.3em] text-indigo-500">{{ tlang $.Lang "offline.cached.title" }}</h2>
          <p class="mt-2 text-sm text-gray-500">{{ tlang $.Lang "offline.cached.subtitle" }}</p>
          <div class="mt-6 space-y-3" data-offline-cache>
            {{ if $view.CachedItems }}
              {{ range $item := $view.CachedItems }}
                <article class="group rounded-2xl border border-gray-200 bg-white px-4 py-3 transition hover:border-indigo-200 hover:bg-indigo-50/60">
                  <a href="{{ $item.Href }}" class="flex flex-col gap-2 text-left no-underline">
                    <div class="flex items-center justify-between gap-3">
                      <h3 class="text-sm font-semibold text-gray-900 group-hover:text-indigo-600">{{ $item.Title }}</h3>
                      {{ if $item.Updated }}
                        <time datetime="{{ $item.UpdatedISO }}" class="text-xs text-gray-400">{{ $item.Updated }}</time>
                      {{ end }}
                    </div>
                    {{ if $item.Description }}<p class="text-xs text-gray-500">{{ $item.Description }}</p>{{ end }}
                  </a>
                </article>
              {{ end }}
            {{ else }}
              <div class="rounded-2xl border border-dashed border-gray-200 bg-white/70 px-4 py-5 text-center text-xs text-gray-500" data-offline-cache-empty>
                {{ tlang $.Lang "offline.cached.empty" }}
              </div>
            {{ end }}
          </div>
          {{ if $view.SupportLink.Href }}
            <div class="mt-6">
              <a href="{{ $view.SupportLink.Href }}" class="inline-flex items-center gap-2 text-xs font-semibold text-indigo-600 hover:text-indigo-500">
                {{ template "icon" (dict "Name" "chat-bubble-left-right" "Class" "h-4 w-4") }}
                <span>{{ if $view.SupportLink.Label }}{{ $view.SupportLink.Label }}{{ else }}{{ tlang $.Lang "offline.support" }}{{ end }}</span>
              </a>
            </div>
          {{ end }}
        </div>
      </div>
    </div>
  </div>

  <section class="rounded-3xl border border-gray-200 bg-white p-8 shadow-sm">
    <header class="space-y-2">
      <h2 class="text-lg font-semibold text-gray-900">{{ tlang $.Lang "offline.progress.title" }}</h2>
      <p class="text-sm text-gray-500">{{ tlang $.Lang "offline.progress.subtitle" }}</p>
    </header>
    <div class="mt-6 grid gap-4 md:grid-cols-3" data-offline-placeholder>
      <article class="rounded-2xl border border-dashed border-gray-200 bg-gray-50/70 p-4 text-sm text-gray-500">
        <header class="flex items-center gap-3">
          <span class="inline-flex h-8 w-8 flex-none items-center justify-center rounded-full bg-white text-indigo-500 shadow">{{ template "icon" (dict "Name" "queue-list" "Class" "h-4 w-4") }}</span>
          <div>
            <p class="text-sm font-semibold text-gray-900">{{ tlang $.Lang "offline.progress.orders.title" }}</p>
            <p class="text-xs text-gray-500">{{ tlang $.Lang "offline.progress.orders.caption" }}</p>
          </div>
        </header>
        <p class="mt-3 text-xs leading-relaxed text-gray-500">{{ tlang $.Lang "offline.progress.orders.body" }}</p>
      </article>
      <article class="rounded-2xl border border-dashed border-gray-200 bg-gray-50/70 p-4 text-sm text-gray-500">
        <header class="flex items-center gap-3">
          <span class="inline-flex h-8 w-8 flex-none items-center justify-center rounded-full bg-white text-indigo-500 shadow">{{ template "icon" (dict "Name" "stamp" "Class" "h-4 w-4") }}</span>
          <div>
            <p class="text-sm font-semibold text-gray-900">{{ tlang $.Lang "offline.progress.designs.title" }}</p>
            <p class="text-xs text-gray-500">{{ tlang $.Lang "offline.progress.designs.caption" }}</p>
          </div>
        </header>
        <p class="mt-3 text-xs leading-relaxed text-gray-500">{{ tlang $.Lang "offline.progress.designs.body" }}</p>
      </article>
      <article class="rounded-2xl border border-dashed border-gray-200 bg-gray-50/70 p-4 text-sm text-gray-500">
        <header class="flex items-center gap-3">
          <span class="inline-flex h-8 w-8 flex-none items-center justify-center rounded-full bg-white text-indigo-500 shadow">{{ template "icon" (dict "Name" "chat-bubble-left-right" "Class" "h-4 w-4") }}</span>
          <div>
            <p class="text-sm font-semibold text-gray-900">{{ tlang $.Lang "offline.progress.support.title" }}</p>
            <p class="text-xs text-gray-500">{{ tlang $.Lang "offline.progress.support.caption" }}</p>
          </div>
        </header>
        <p class="mt-3 text-xs leading-relaxed text-gray-500">{{ tlang $.Lang "offline.progress.support.body" }}</p>
      </article>
    </div>
  </section>
</section>

<script>
(function(){
  var area = document.querySelector('[data-offline-cache]');
  if (!area) { return; }
  function safePath(raw){
    if (typeof raw !== 'string' || !raw) { return '/'; }
    try {
      var url = new URL(raw, window.location.origin);
      if (url.origin === window.location.origin) {
        return url.pathname + url.search + url.hash;
      }
    } catch (_) {}
    if (raw.charAt(0) === '/') { return raw; }
    return '/';
  }
  function safeString(value){
    return typeof value === 'string' ? value : '';
  }
  function isISO(ts){
    return typeof ts === 'string' && ts.length <= 40 && /^[0-9T:\-+.Z]+$/.test(ts);
  }
  try {
    var raw = localStorage.getItem('hanko:offline:recent');
    if (!raw) { return; }
    var data = JSON.parse(raw);
    if (!Array.isArray(data) || !data.length) { return; }
    area.innerHTML = '';
    data.slice(0, 6).forEach(function(entry){
      if (!entry || !entry.href || !entry.title) { return; }
      var title = safeString(entry.title).trim();
      if (!title) { return; }
      var description = safeString(entry.description).trim();
      var href = safePath(entry.href);
      var card = document.createElement('article');
      card.className = 'group rounded-2xl border border-gray-200 bg-white px-4 py-3 transition hover:border-indigo-200 hover:bg-indigo-50/60';
      var link = document.createElement('a');
      link.className = 'flex flex-col gap-2 text-left no-underline';
      link.setAttribute('href', href);

      var header = document.createElement('div');
      header.className = 'flex items-center justify-between gap-3';

      var heading = document.createElement('h3');
      heading.className = 'text-sm font-semibold text-gray-900 group-hover:text-indigo-600';
      heading.textContent = title;
      header.appendChild(heading);

      if (isISO(entry.updatedISO)) {
        var time = document.createElement('time');
        time.className = 'text-xs text-gray-400';
        time.setAttribute('datetime', entry.updatedISO);
        time.textContent = safeString(entry.updated || '');
        header.appendChild(time);
      }

      link.appendChild(header);

      if (description) {
        var para = document.createElement('p');
        para.className = 'text-xs text-gray-500';
        para.textContent = description;
        link.appendChild(para);
      }

      card.appendChild(link);
      area.appendChild(card);
    });
  } catch (_) {}
})();
</script>
{{ end }}
