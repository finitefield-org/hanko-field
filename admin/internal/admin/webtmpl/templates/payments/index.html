{{define "payments/index"}}
{{template "layouts/base" .}}
{{end}}

{{define "payments/content"}}
{{$page := .Page}}
<div class="space-y-6" data-payments-transactions-root>
  <section class="rounded-2xl bg-white px-6 py-6 shadow-sm ring-1 ring-slate-200">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
      <div class="space-y-2">
        <h1 class="text-2xl font-semibold text-slate-900">{{$page.Title}}</h1>
        <p class="text-sm text-slate-600">{{$page.Description}}</p>
      </div>
      <div class="flex flex-col items-stretch gap-3 lg:items-end">
        {{if gt (len $page.SummaryCards) 0}}
          <div class="grid w-full gap-3 sm:grid-cols-2 lg:w-auto lg:grid-cols-3">
            {{range $card := $page.SummaryCards}}
              {{template "payments/summary-card" $card}}
            {{end}}
          </div>
        {{end}}
        <div class="flex flex-wrap items-center gap-3">
          <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="payments-saved-view">ä¿å­˜ãƒ“ãƒ¥ãƒ¼</label>
          <select
            id="payments-saved-view"
            name="view"
            class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
            form="payments-filter"
          >
            {{range $view := $page.SavedViews}}
              <option value="{{$view.Value}}" {{if $view.Selected}}selected{{end}}>{{$view.Label}}</option>
            {{end}}
          </select>
          <a
            href="{{$page.ExportURL}}"
            class="{{buttonClass "outline" "sm" false false}}"
            target="_blank"
            rel="noopener noreferrer"
          >
            ğŸ“¥ å–å¼•ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
          </a>
        </div>
      </div>
    </div>
    <div class="mt-6 border-t border-slate-200 pt-4">
      {{template "payments/filter-toolbar" $page}}
    </div>
  </section>

  <div class="grid gap-6 xl:grid-cols-[minmax(0,1fr)_360px]">
    <section class="flex flex-col gap-4">
      {{if or (gt $page.Toolbar.SelectedCount 0) $page.Toolbar.RenderWhenEmpty}}
        {{template "components/bulk-toolbar" $page.Toolbar}}
      {{end}}
      <div
        id="payments-transactions-table-container"
        class="space-y-4"
      >
        {{template "payments/table" .Table}}
      </div>
    </section>
    <aside class="hidden xl:block">
      <div
        class="sticky top-20 space-y-4"
        id="payments-transaction-drawer"
        hx-target="this"
        hx-swap="innerHTML"
        data-payments-drawer
      >
        {{template "payments/drawer" $page.Drawer}}
      </div>
    </aside>
  </div>
</div>
{{end}}

{{define "payments/summary-card"}}
<div class="flex min-w-[180px] flex-col gap-1 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600 shadow-sm">
  <div class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-slate-500">
    {{if .Icon}}
      <span aria-hidden="true">{{.Icon}}</span>
    {{end}}
    {{.Label}}
  </div>
  <div class="text-xl font-semibold text-slate-900">{{.Value}}</div>
  {{if .SubLabel}}
    <p class="text-xs text-slate-500">{{.SubLabel}}</p>
  {{end}}
  {{if .Delta}}
    <p class="{{paymentsSummaryDeltaClass .DeltaTone}}">{{.Delta}}</p>
  {{end}}
</div>
{{end}}

{{define "payments/filter-toolbar"}}
<form
  id="payments-filter"
  class="flex flex-col gap-6"
  method="get"
  hx-get="{{.TableEndpoint}}"
  hx-target="#payments-transactions-table"
  hx-swap="outerHTML"
  hx-push-url="true"
>
  <input type="hidden" name="page" value="0" />
  <input type="hidden" name="pageSize" value="{{.Query.PageSize}}" />
  <input type="hidden" name="selected" value="{{.Query.SelectedID}}" />

  <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
    <div class="flex flex-col gap-2">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="payments-provider">ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼</label>
      <select
        id="payments-provider"
        name="provider"
        class="min-h-[140px] rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
        multiple
      >
        {{range $option := .Filters.ProviderOptions}}
          <option value="{{$option.Value}}" {{if $option.Selected}}selected{{end}}>
            {{$option.Label}}
            {{if gt $option.Count 0}}
              Â· {{$option.Count}}
            {{end}}
          </option>
        {{end}}
      </select>
    </div>
    <div class="flex flex-col gap-2">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span>
      <div class="flex flex-wrap gap-2" role="group" aria-label="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹">
        {{range $status := .Filters.StatusOptions}}
          <label class="{{paymentsStatusChipClass $status.Active $status.Tone}}">
            <input type="checkbox" name="status" value="{{$status.Value}}" class="sr-only" {{if $status.Active}}checked{{end}} />
            <span class="inline-flex items-center gap-1 text-sm">
              {{$status.Label}}
              {{if gt $status.Count 0}}
                <span class="text-xs text-slate-600">{{$status.Count}}</span>
              {{end}}
            </span>
          </label>
        {{end}}
      </div>
    </div>
    <div class="flex flex-col gap-2">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="payments-from">æ±ºæ¸ˆæ—¥ (From)</label>
      <input
        id="payments-from"
        name="from"
        type="date"
        value="{{.Query.From}}"
        class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
      />
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="payments-to">æ±ºæ¸ˆæ—¥ (To)</label>
      <input
        id="payments-to"
        name="to"
        type="date"
        value="{{.Query.To}}"
        class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
      />
    </div>
    <div class="flex flex-col gap-2">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="payments-amount-min">é‡‘é¡ãƒ¬ãƒ³ã‚¸ (Â¥)</label>
      <div class="flex items-center gap-2">
        <input
          id="payments-amount-min"
          name="amountMin"
          type="number"
          min="0"
          value="{{.Query.AmountMin}}"
          placeholder="{{.Filters.AmountMinBound}}"
          class="w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
        />
        <span class="text-xs text-slate-500">ã€œ</span>
        <input
          id="payments-amount-max"
          name="amountMax"
          type="number"
          min="0"
          value="{{.Query.AmountMax}}"
          placeholder="{{.Filters.AmountMaxBound}}"
          class="w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
        />
      </div>
      {{if .Filters.AmountHint}}
        <p class="text-xs text-slate-500">{{.Filters.AmountHint}}</p>
      {{end}}
    </div>
  </div>

  <div class="flex flex-wrap items-center justify-between gap-3">
    <label class="inline-flex items-center gap-2 text-sm font-medium text-slate-700">
      <input
        type="checkbox"
        name="flagged"
        value="1"
        class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-500"
        {{if .Query.OnlyFlagged}}checked{{end}}
      />
      <span>ãƒªã‚¹ã‚¯ãƒ•ãƒ©ã‚°ä»˜ãã®ã¿ ({{.Filters.FlaggedCount}}ä»¶)</span>
    </label>
    <div class="flex flex-wrap items-center gap-3">
      <button type="submit" class="{{buttonClass "primary" "sm" false false}}">ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨</button>
      <a href="{{.ResetURL}}" class="{{buttonClass "ghost" "sm" false false}}">ãƒªã‚»ãƒƒãƒˆ</a>
    </div>
  </div>
</form>
{{end}}
