{{define "orders/table"}}
{{$table := .Table}}
{{$sort := $table.Sort}}
<div class="space-y-4" data-orders-table-fragment>
  {{if $table.Error}}
    <div class="rounded-lg border border-danger-200 bg-danger-50 px-4 py-3 text-sm text-danger-800">
      {{$table.Error}}
    </div>
  {{end}}

  <form id="orders-selection" class="space-y-0 overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm" method="post">
    <table class="min-w-full divide-y divide-slate-200">
      <caption class="sr-only">Ê≥®Êñá‰∏ÄË¶ßÔºàÂÖ® {{$table.Pagination.Total}} ‰ª∂Ôºâ</caption>
      <thead class="bg-slate-50">
        <tr class="text-xs font-semibold uppercase tracking-wide text-slate-500">
          <th scope="col" class="w-12 px-4 py-3">
            <input
              type="checkbox"
              class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-500"
              data-orders-master
              aria-label="ÂÖ®„Å¶„ÅÆÊ≥®Êñá„ÇíÈÅ∏Êäû"
            />
          </th>
          <th scope="col" class="px-4 py-3 text-left text-slate-600">Ê≥®Êñá</th>
          <th scope="col" class="px-4 py-3 text-left text-slate-600">È°ßÂÆ¢</th>
          {{$totalDir := sortCurrentDirection $sort.Active "total"}}
          <th
            scope="col"
            class="px-4 py-3 text-right text-slate-600"
            aria-sort="{{sortAria $totalDir}}"
            data-sort-key="total"
            data-sort-direction="{{$totalDir}}"
          >
            <a
              class="{{sortHeaderClass $totalDir}}"
              href="{{sortHref $sort.BasePath $sort.RawQuery $sort.Param $sort.PageParam $sort.Active "total" "desc" true}}"
              {{if or $table.HxTarget $table.HxSwap $sort.HxPushURL}}
                hx-get="{{sortHxHref $sort.FragmentPath $sort.RawQuery $sort.Param $sort.PageParam $sort.Active "total" "desc" true}}"
                {{if $table.HxTarget}}hx-target="{{$table.HxTarget}}"{{end}}
                {{if $table.HxSwap}}hx-swap="{{$table.HxSwap}}"{{end}}
                {{if $sort.HxPushURL}}hx-push-url="true"{{end}}
              {{end}}
              role="button"
              aria-pressed="{{if $totalDir}}true{{else}}false{{end}}"
              data-next-direction="{{sortNextDirectionAttr $sort.Active "total" "desc"}}"
            >
              <span class="flex items-center gap-1">
                <span>ÂêàË®à</span>
                <span class="sr-only">{{sortSrLabel "ÂêàË®à" $sort.Active "total" "desc"}}</span>
                <span aria-hidden="true" class="{{sortIconClass $totalDir}}">
                  {{if eq $totalDir "asc"}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-600" focusable="false">
                      <path d="M10 5l-3 3h6l-3-3z" fill="currentColor"></path>
                      <path d="M13 12l-3 3-3-3h6z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" fill="none" opacity="0.45"></path>
                    </svg>
                  {{else if eq $totalDir "desc"}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-600" focusable="false">
                      <path d="M7 8l3-3 3 3H7z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" fill="none" opacity="0.45"></path>
                      <path d="M10 15l3-3H7l3 3z" fill="currentColor"></path>
                    </svg>
                  {{else}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-500" focusable="false">
                      <path d="M10 5l-2.5 2.5h5L10 5z" fill="currentColor" opacity="0.75"></path>
                      <path d="M10 15l2.5-2.5h-5L10 15z" fill="currentColor" opacity="0.75"></path>
                    </svg>
                  {{end}}
                </span>
              </span>
            </a>
          </th>
          {{$statusDir := sortCurrentDirection $sort.Active "status"}}
          <th
            scope="col"
            class="px-4 py-3 text-left text-slate-600"
            aria-sort="{{sortAria $statusDir}}"
            data-sort-key="status"
            data-sort-direction="{{$statusDir}}"
          >
            <a
              class="{{sortHeaderClass $statusDir}}"
              href="{{sortHref $sort.BasePath $sort.RawQuery $sort.Param $sort.PageParam $sort.Active "status" "asc" true}}"
              {{if or $table.HxTarget $table.HxSwap $sort.HxPushURL}}
                hx-get="{{sortHxHref $sort.FragmentPath $sort.RawQuery $sort.Param $sort.PageParam $sort.Active "status" "asc" true}}"
                {{if $table.HxTarget}}hx-target="{{$table.HxTarget}}"{{end}}
                {{if $table.HxSwap}}hx-swap="{{$table.HxSwap}}"{{end}}
                {{if $sort.HxPushURL}}hx-push-url="true"{{end}}
              {{end}}
              role="button"
              aria-pressed="{{if $statusDir}}true{{else}}false{{end}}"
              data-next-direction="{{sortNextDirectionAttr $sort.Active "status" "asc"}}"
            >
              <span class="flex items-center gap-1">
                <span>„Çπ„ÉÜ„Éº„Çø„Çπ</span>
                <span class="sr-only">{{sortSrLabel "„Çπ„ÉÜ„Éº„Çø„Çπ" $sort.Active "status" "asc"}}</span>
                <span aria-hidden="true" class="{{sortIconClass $statusDir}}">
                  {{if eq $statusDir "asc"}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-600" focusable="false">
                      <path d="M10 5l-3 3h6l-3-3z" fill="currentColor"></path>
                      <path d="M13 12l-3 3-3-3h6z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" fill="none" opacity="0.45"></path>
                    </svg>
                  {{else if eq $statusDir "desc"}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-600" focusable="false">
                      <path d="M7 8l3-3 3 3H7z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" fill="none" opacity="0.45"></path>
                      <path d="M10 15l3-3H7l3 3z" fill="currentColor"></path>
                    </svg>
                  {{else}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-500" focusable="false">
                      <path d="M10 5l-2.5 2.5h5L10 5z" fill="currentColor" opacity="0.75"></path>
                      <path d="M10 15l2.5-2.5h-5L10 15z" fill="currentColor" opacity="0.75"></path>
                    </svg>
                  {{end}}
                </span>
              </span>
            </a>
          </th>
          {{$updatedDir := sortCurrentDirection $sort.Active "updated_at"}}
          <th
            scope="col"
            class="px-4 py-3 text-left text-slate-600"
            aria-sort="{{sortAria $updatedDir}}"
            data-sort-key="updated_at"
            data-sort-direction="{{$updatedDir}}"
          >
            <a
              class="{{sortHeaderClass $updatedDir}}"
              href="{{sortHref $sort.BasePath $sort.RawQuery $sort.Param $sort.PageParam $sort.Active "updated_at" "desc" true}}"
              {{if or $table.HxTarget $table.HxSwap $sort.HxPushURL}}
                hx-get="{{sortHxHref $sort.FragmentPath $sort.RawQuery $sort.Param $sort.PageParam $sort.Active "updated_at" "desc" true}}"
                {{if $table.HxTarget}}hx-target="{{$table.HxTarget}}"{{end}}
                {{if $table.HxSwap}}hx-swap="{{$table.HxSwap}}"{{end}}
                {{if $sort.HxPushURL}}hx-push-url="true"{{end}}
              {{end}}
              role="button"
              aria-pressed="{{if $updatedDir}}true{{else}}false{{end}}"
              data-next-direction="{{sortNextDirectionAttr $sort.Active "updated_at" "desc"}}"
            >
              <span class="flex items-center gap-1">
                <span>Êõ¥Êñ∞Êó•ÊôÇ</span>
                <span class="sr-only">{{sortSrLabel "Êõ¥Êñ∞Êó•ÊôÇ" $sort.Active "updated_at" "desc"}}</span>
                <span aria-hidden="true" class="{{sortIconClass $updatedDir}}">
                  {{if eq $updatedDir "asc"}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-600" focusable="false">
                      <path d="M10 5l-3 3h6l-3-3z" fill="currentColor"></path>
                      <path d="M13 12l-3 3-3-3h6z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" fill="none" opacity="0.45"></path>
                    </svg>
                  {{else if eq $updatedDir "desc"}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-600" focusable="false">
                      <path d="M7 8l3-3 3 3H7z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" fill="none" opacity="0.45"></path>
                      <path d="M10 15l3-3H7l3 3z" fill="currentColor"></path>
                    </svg>
                  {{else}}
                    <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4 text-slate-500" focusable="false">
                      <path d="M10 5l-2.5 2.5h5L10 5z" fill="currentColor" opacity="0.75"></path>
                      <path d="M10 15l2.5-2.5h-5L10 15z" fill="currentColor" opacity="0.75"></path>
                    </svg>
                  {{end}}
                </span>
              </span>
            </a>
          </th>
          <th scope="col" class="px-4 py-3 text-left text-slate-600">„Éê„ÉÉ„Ç∏</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 text-sm text-slate-700">
        {{if eq (len $table.Rows) 0}}
          <tr>
            <td colspan="7" class="px-4 py-8 text-center text-sm text-slate-500">
              {{if $table.EmptyMessage}}
                {{$table.EmptyMessage}}
              {{else}}
                Ë°®Á§∫„Åô„ÇãÊ≥®Êñá„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
              {{end}}
            </td>
          </tr>
        {{else}}
          {{range $row := $table.Rows}}
            <tr class="hover:bg-slate-50" data-order-id="{{$row.ID}}">
              <td class="px-4 py-4 align-top">
                <input
                  type="checkbox"
                  class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-500"
                  name="orderID"
                  value="{{$row.ID}}"
                  data-orders-checkbox
                  data-order-number="{{$row.Number}}"
                  aria-label="{{printf "Ê≥®Êñá %s „ÇíÈÅ∏Êäû" $row.Number}}"
                />
                <span class="hidden" aria-hidden="true" data-order-index>{{$row.Index}}</span>
              </td>
              <td class="px-4 py-4 align-top">
                <div class="flex flex-col gap-1">
                  <a href="{{$row.URL}}" class="font-semibold text-slate-900 hover:text-brand-600">
                    # {{$row.Number}}
                  </a>
                  {{if $row.ItemsSummary}}
                    <p class="text-xs text-slate-500">{{$row.ItemsSummary}}</p>
                  {{end}}
                  {{if gt (len $row.Notes) 0}}
                    <ul class="space-y-1 text-xs text-slate-500">
                      {{range $note := $row.Notes}}
                        <li>üìù {{$note}}</li>
                      {{end}}
                    </ul>
                  {{end}}
                </div>
              </td>
              <td class="px-4 py-4 align-top">
                <div class="space-y-1">
                  <p class="font-medium text-slate-900">{{$row.CustomerName}}</p>
                  {{if $row.CustomerMeta}}
                    <p class="text-xs text-slate-500">{{$row.CustomerMeta}}</p>
                  {{else if $row.CustomerEmail}}
                    <p class="text-xs text-slate-500">{{$row.CustomerEmail}}</p>
                  {{end}}
                </div>
              </td>
              <td class="px-4 py-4 text-right align-top font-semibold text-slate-900">
                {{$row.Total}}
              </td>
              <td class="px-4 py-4 align-top">
                {{template "orders/status-cell" $row.StatusCell}}
              </td>
              <td class="px-4 py-4 align-top">
                <div class="flex flex-col gap-1 text-xs text-slate-500">
                  <p>
                    <span class="font-medium text-slate-600">{{$row.UpdatedLabel}}</span>
                    <span class="ml-1 text-slate-400">({{$row.UpdatedRelative}})</span>
                  </p>
                  {{if $row.PromisedAtLabel}}
                    <p>Á¥ÑÊùüÊó•ÊôÇ: {{$row.PromisedAtLabel}}</p>
                  {{end}}
                </div>
              </td>
              <td class="px-4 py-4 align-top">
                <div class="flex flex-wrap gap-2">
                  {{range $badge := $row.Badges}}
                    <span class="{{badgeClass $badge.Tone}}" {{if $badge.Title}}title="{{$badge.Title}}"{{end}}>
                      {{if $badge.Icon}}<span aria-hidden="true" class="mr-1">{{$badge.Icon}}</span>{{end}}
                      {{$badge.Label}}
                    </span>
                  {{end}}
                  {{if $row.HasRefundRequest}}
                    <span class="{{badgeClass "warning"}}">ËøîÈáëÁî≥Ë´ã</span>
                  {{end}}
                  {{range $tag := $row.Tags}}
                    <span class="rounded-full bg-slate-100 px-2 py-1 text-xs text-slate-600">#{{$tag}}</span>
                  {{end}}
                </div>
              </td>
            </tr>
          {{end}}
        {{end}}
      </tbody>
    </table>
  </form>

  <div
    id="orders-bulk-toolbar"
    class="hidden items-center justify-between rounded-lg border border-brand-200 bg-brand-50 px-4 py-3 text-sm text-slate-900 shadow-sm md:flex"
    data-orders-bulk-toolbar
    data-orders-total="{{$table.Pagination.Total}}"
  >
    <div class="flex items-center gap-3">
      <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-brand-600 text-sm font-semibold text-white" data-orders-bulk-count>
        0
      </span>
      <div class="space-y-1">
        <p class="text-sm font-semibold text-slate-900">ÈÅ∏Êäû‰∏≠„ÅÆÊ≥®Êñá</p>
        <button type="button" class="text-xs font-semibold text-brand-600 hover:text-brand-700" data-orders-bulk-clear>ÈÅ∏Êäû„ÇíËß£Èô§</button>
      </div>
    </div>
    <div class="flex flex-wrap items-center gap-2">
      <button
        type="button"
        class="{{buttonClass "primary" "sm" false false}}"
        data-orders-bulk-action="status"
        disabled
        hx-post="{{printf "%s/bulk/status" $table.BasePath}}"
        hx-include="#orders-selection,#orders-filter"
        hx-target="#orders-table"
        hx-swap="none"
      >
        „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
      </button>
      <button
        type="button"
        class="{{buttonClass "secondary" "sm" false false}}"
        data-orders-bulk-action="labels"
        disabled
        hx-post="{{printf "%s/bulk/labels" $table.BasePath}}"
        hx-include="#orders-selection,#orders-filter"
        hx-target="#orders-table"
        hx-swap="none"
      >
        Âá∫Ëç∑„É©„Éô„É´ÁîüÊàê
      </button>
      <button
        type="button"
        class="{{buttonClass "secondary" "sm" false false}}"
        data-orders-bulk-action="export-csv"
        disabled
        hx-post="{{printf "%s/bulk/export" $table.BasePath}}"
        hx-include="#orders-selection,#orders-filter"
        hx-vals='{"format":"csv"}'
        hx-target="#orders-table"
        hx-swap="none"
      >
        CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà
      </button>
      <button
        type="button"
        class="{{buttonClass "secondary" "sm" false false}}"
        data-orders-bulk-action="export-pdf"
        disabled
        hx-post="{{printf "%s/bulk/export" $table.BasePath}}"
        hx-include="#orders-selection,#orders-filter"
        hx-vals='{"format":"pdf"}'
        hx-target="#orders-table"
        hx-swap="none"
      >
        PDFÂç∞Âà∑
      </button>
    </div>
  </div>

  {{template "components/pagination" .Pagination}}
</div>
{{end}}
