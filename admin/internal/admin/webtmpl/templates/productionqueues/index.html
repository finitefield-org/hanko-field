{{define "production-queues/index"}}
{{template "layouts/base" .}}
{{end}}

{{define "production-queues/content"}}
<div class="space-y-6" data-production-queues-root>
  <section class="rounded-2xl bg-white px-6 py-6 shadow-sm ring-1 ring-slate-200">
    <div class="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
      <div class="space-y-2">
        <h1 class="text-2xl font-semibold text-slate-900">{{.Page.Title}}</h1>
        {{if .Page.Description}}
          <p class="text-sm text-slate-600">{{.Page.Description}}</p>
        {{end}}
      </div>
      <div class="flex w-full flex-col gap-4 sm:items-end lg:w-auto">
        {{if gt (len .Page.Analytics) 0}}
          {{template "production-queues/analytics" .Page.Analytics}}
        {{end}}
        <div class="flex justify-end">
          <button
            type="button"
            class="{{buttonClass "primary" "md" false false}}"
            hx-get="{{buildURL .Page.Actions.NewQueueURL .Page.Query.RawQuery}}"
            hx-target="#modal"
            hx-swap="innerHTML"
          >
            åˆ¶ä½œã‚­ãƒ¥ãƒ¼ã‚’è¿½åŠ 
          </button>
        </div>
      </div>
    </div>
    <div class="mt-6 border-t border-slate-200 pt-4">
      {{template "production-queues/filter" .}}
    </div>
  </section>

  {{if .Page.Error}}
    <div class="rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">{{.Page.Error}}</div>
  {{end}}

  <div class="grid gap-6 xl:grid-cols-[minmax(0,1fr)_360px]">
    <section class="space-y-4">
      {{template "production-queues/table" (dict "BasePath" .BasePath "Table" .Page.Table)}}
    </section>
    <aside class="hidden xl:block">
      <div class="sticky top-20">
        {{template "production-queues/drawer" (dict "Drawer" .Page.Drawer)}}
      </div>
    </aside>
  </div>
</div>
{{end}}

{{define "production-queues/analytics"}}
<div class="grid w-full gap-3 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2">
  {{range .}}
    <div class="flex flex-col gap-1 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 shadow-sm">
      <div class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-slate-500">
        {{if .Icon}}<span aria-hidden="true">{{.Icon}}</span>{{end}}
        {{.Label}}
      </div>
      <div class="text-xl font-semibold text-slate-900">{{.Value}}</div>
      {{if .SubLabel}}<div class="text-xs text-slate-500">{{.SubLabel}}</div>{{end}}
    </div>
  {{end}}
</div>
{{end}}

{{define "production-queues/filter"}}
<form
  class="space-y-4"
  method="get"
  hx-get="{{.Page.Filters.Endpoint}}"
  hx-target="#{{productionQueuesTableContainerID}}"
  hx-swap="outerHTML"
  hx-push-url="true"
>
  <input type="hidden" name="selected" value="{{.Page.Query.SelectedID}}" />
  <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-4">
    <div class="flex flex-col gap-2">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="queue-filter-search">æ¤œç´¢</label>
      <div class="relative">
        <input
          id="queue-filter-search"
          name="search"
          type="search"
          value="{{.Page.Query.Search}}"
          placeholder="ã‚­ãƒ¥ãƒ¼åãƒ»ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—"
          class="w-full rounded-lg border border-slate-300 bg-white py-2 pl-8 pr-3 text-sm text-slate-900 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
        />
        <span class="pointer-events-none absolute inset-y-0 left-2 flex items-center text-slate-400">ğŸ”</span>
      </div>
    </div>
    <div class="flex flex-col gap-2">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="queue-filter-workshop">å·¥æˆ¿</label>
      <select
        id="queue-filter-workshop"
        name="workshop"
        class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
      >
        {{range .Page.Filters.Workshops}}
          <option value="{{.Value}}" {{if .Active}}selected{{end}}>
            {{if gt .Count 0}}
              {{.Label}} ({{.Count}})
            {{else}}
              {{.Label}}
            {{end}}
          </option>
        {{end}}
      </select>
    </div>
    <div class="flex flex-col gap-2">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="queue-filter-status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
      <select
        id="queue-filter-status"
        name="status"
        class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
      >
        {{range .Page.Filters.Statuses}}
          <option value="{{.Value}}" {{if .Active}}selected{{end}}>
            {{if gt .Count 0}}
              {{.Label}} ({{.Count}})
            {{else}}
              {{.Label}}
            {{end}}
          </option>
        {{end}}
      </select>
    </div>
    <div class="flex flex-col gap-2">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="queue-filter-product">ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒ©ã‚¤ãƒ³</label>
      <select
        id="queue-filter-product"
        name="product_line"
        class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
      >
        {{range .Page.Filters.ProductLines}}
          <option value="{{.Value}}" {{if .Active}}selected{{end}}>
            {{if gt .Count 0}}
              {{.Label}} ({{.Count}})
            {{else}}
              {{.Label}}
            {{end}}
          </option>
        {{end}}
      </select>
    </div>
  </div>
  <div class="flex flex-wrap items-center gap-3">
    <button type="submit" class="{{buttonClass "primary" "sm" false false}}">é©ç”¨</button>
    <a href="{{.Page.Filters.ResetURL}}" class="{{buttonClass "ghost" "sm" false false}}">ãƒªã‚»ãƒƒãƒˆ</a>
    <div class="htmx-indicator text-xs text-slate-400">æ›´æ–°ä¸­â€¦</div>
  </div>
</form>
{{end}}

{{define "production-queues/table"}}
<div
  id="{{productionQueuesTableContainerID}}"
  class="space-y-4"
  data-production-queues-table
  hx-target="this"
  hx-swap="{{.Table.HxSwap}}"
  hx-trigger="refresh from:body"
  hx-get="{{buildURL .Table.FragmentPath .Table.RawQuery}}"
>
  <div class="overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm">
    <table class="min-w-full divide-y divide-slate-200 text-sm text-slate-700">
      <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
        <tr>
          <th scope="col" class="px-4 py-3 text-left">ã‚­ãƒ¥ãƒ¼</th>
          <th scope="col" class="px-4 py-3 text-left">å®¹é‡</th>
          <th scope="col" class="px-4 py-3 text-left">SLA</th>
          <th scope="col" class="px-4 py-3 text-left">ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ</th>
          <th scope="col" class="px-4 py-3 text-left">WIP</th>
          <th scope="col" class="px-4 py-3 text-left">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          <th scope="col" class="px-4 py-3 text-right">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        {{if eq (len .Table.Rows) 0}}
          <tr>
            <td colspan="7" class="px-4 py-6 text-center text-sm text-slate-500">{{.Table.EmptyMessage}}</td>
          </tr>
        {{else}}
          {{range .Table.Rows}}
            {{$selectedQuery := setRawQuery $.Table.RawQuery "selected" .ID}}
            <tr
              class="{{productionQueuesQueueRowClass .Selected}}"
              {{if .Selected}}aria-current="true"{{end}}
              hx-get="{{buildURL .DrawerURL $selectedQuery}}"
              hx-target="{{$.Table.DrawerTarget}}"
              hx-push-url="{{buildURL (joinBase $.BasePath "/production-queues") $selectedQuery}}"
            >
              <td class="px-4 py-3">
                <div class="flex flex-col gap-1">
                  <div class="flex items-center gap-2">
                    <span class="font-semibold text-slate-900">{{.Name}}</span>
                    <span class="{{badgeClass .PriorityTone}}">{{.PriorityLabel}}</span>
                  </div>
                  <p class="text-xs text-slate-500">{{.Workshop}}</p>
                  {{if .ProductLine}}<p class="text-xs text-slate-500">{{.ProductLine}}</p>{{end}}
                </div>
              </td>
              <td class="px-4 py-3 text-slate-600">{{.CapacityLabel}}</td>
              <td class="px-4 py-3 text-slate-600">{{.SLALabel}}</td>
              <td class="px-4 py-3 text-slate-600">{{.ThroughputLabel}}</td>
              <td class="px-4 py-3">
                <span class="{{badgeClass .UtilisationTone}}">{{.UtilisationLabel}}</span>
              </td>
              <td class="px-4 py-3">
                <span class="{{badgeClass (productionQueuesActiveTone .Active)}}">{{.ActiveLabel}}</span>
              </td>
              <td class="px-4 py-3 text-right">
                <div class="flex justify-end gap-2" hx-target="{{$.Table.HxTarget}}" hx-swap="{{$.Table.HxSwap}}">
                  <button
                    type="button"
                    class="{{buttonClass "ghost" "xs" false false}}"
                    hx-post="{{buildURL .ToggleURL $selectedQuery}}"
                    hx-target="{{$.Table.HxTarget}}"
                    hx-swap="{{$.Table.HxSwap}}"
                    onclick="event.stopPropagation()"
                  >
                    {{if .Active}}åœæ­¢{{else}}ç¨¼åƒ{{end}}
                  </button>
                  <button
                    type="button"
                    class="{{buttonClass "ghost" "xs" false false}}"
                    hx-get="{{buildURL .EditURL $.Table.RawQuery}}"
                    hx-target="#modal"
                    hx-swap="innerHTML"
                    onclick="event.stopPropagation()"
                  >
                    ç·¨é›†
                  </button>
                  <button
                    type="button"
                    class="{{buttonClass "ghost" "xs" false false}}"
                    hx-get="{{buildURL .DeleteURL $.Table.RawQuery}}"
                    hx-target="#modal"
                    hx-swap="innerHTML"
                    onclick="event.stopPropagation()"
                  >
                    å‰Šé™¤
                  </button>
                </div>
              </td>
            </tr>
          {{end}}
        {{end}}
      </tbody>
    </table>
  </div>
</div>
{{end}}

{{define "production-queues/table-with-drawer"}}
{{template "production-queues/table" .}}
{{template "production-queues/drawer-oob" (dict "Drawer" .Drawer)}}
{{end}}

{{define "production-queues/drawer"}}
{{template "production-queues/drawer-container" (dict "Drawer" .Drawer "OOB" false)}}
{{end}}

{{define "production-queues/drawer-oob"}}
{{template "production-queues/drawer-container" (dict "Drawer" .Drawer "OOB" true)}}
{{end}}

{{define "production-queues/drawer-container"}}
<div
  id="{{productionQueuesDrawerContainerID}}"
  class="rounded-2xl border border-slate-200 bg-white shadow-sm"
  hx-target="this"
  hx-swap="innerHTML"
  {{if .OOB}}hx-swap-oob="true"{{end}}
>
  {{if .Drawer.Empty}}
    <div class="p-6 text-sm text-slate-500">
      <p>è©³ç´°ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã‚­ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
    </div>
  {{else}}
    {{template "production-queues/drawer-content" .Drawer}}
  {{end}}
</div>
{{end}}

{{define "production-queues/drawer-content"}}
<div class="space-y-6 p-6">
  <div class="flex items-start justify-between gap-3">
    <div class="space-y-1">
      <div class="flex items-center gap-2">
        <h2 class="text-lg font-semibold text-slate-900">{{.Queue.Name}}</h2>
        <span class="{{badgeClass .Queue.ActiveTone}}">{{.Queue.ActiveLabel}}</span>
      </div>
      <p class="text-xs text-slate-500">
        æœ€çµ‚æ›´æ–° {{.Queue.UpdatedAt}}
        {{if .Queue.UpdatedRelative}}<span class="ml-2">({{.Queue.UpdatedRelative}})</span>{{end}}
      </p>
    </div>
    <div class="flex gap-2">
      {{if .Actions.EditURL}}
        <button
          type="button"
          class="{{buttonClass "secondary" "sm" false false}}"
          hx-get="{{.Actions.EditURL}}"
          hx-target="#modal"
          hx-swap="innerHTML"
        >
          ç·¨é›†
        </button>
      {{end}}
      {{if .Actions.DeleteURL}}
        <button
          type="button"
          class="{{buttonClass "ghost" "sm" false false}}"
          hx-get="{{.Actions.DeleteURL}}"
          hx-target="#modal"
          hx-swap="innerHTML"
        >
          å‰Šé™¤
        </button>
      {{end}}
    </div>
  </div>

  {{if .Queue.Description}}
    <p class="text-sm text-slate-600">{{.Queue.Description}}</p>
  {{end}}

  <div class="grid gap-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
    <div class="flex items-center justify-between">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">å®¹é‡</span>
      <span class="font-semibold text-slate-900">{{.Queue.CapacityLabel}}</span>
    </div>
    <div class="flex items-center justify-between">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">SLAç›®æ¨™</span>
      <span class="font-semibold text-slate-900">{{.Queue.TargetSLALabel}}</span>
    </div>
    <div class="flex items-center justify-between">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">å¹³å‡ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ</span>
      <span class="font-semibold text-slate-900">{{.Queue.ThroughputLabel}}</span>
    </div>
    <div class="flex items-center justify-between">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">å¹³å‡WIP</span>
      <span class="font-semibold text-slate-900">{{.Queue.UtilisationLabel}}</span>
    </div>
    <div class="flex items-center justify-between">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">SLAé”æˆç‡</span>
      <span class="font-semibold text-slate-900">{{.Queue.SLAComplianceLabel}}</span>
    </div>
  </div>

  <div class="space-y-3">
    <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">ãƒ¯ãƒ¼ã‚¯ã‚»ãƒ³ã‚¿ãƒ¼</h3>
    {{if eq (len .Queue.WorkCenters) 0}}
      <p class="text-sm text-slate-500">å‰²ã‚Šå½“ã¦æ¸ˆã¿ã®ãƒ¯ãƒ¼ã‚¯ã‚»ãƒ³ã‚¿ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {{else}}
      <ul class="space-y-2 text-sm text-slate-700">
        {{range .Queue.WorkCenters}}
          <li class="flex flex-col rounded-lg border border-slate-200 px-3 py-2">
            <div class="flex items-center gap-2">
              <span class="font-medium text-slate-900">{{.Name}}</span>
              {{if .Primary}}<span class="{{badgeClass "info"}}">Primary</span>{{end}}
              {{if not .Active}}<span class="{{badgeClass "warning"}}">åœæ­¢ä¸­</span>{{end}}
            </div>
            {{if or .Location .Capability}}
              <p class="text-xs text-slate-500">
                {{.Location}}{{if and .Capability .Location}} Â· {{end}}{{.Capability}}
              </p>
            {{end}}
          </li>
        {{end}}
      </ul>
    {{end}}
  </div>

  <div class="space-y-3">
    <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">æ‹…å½“ãƒ­ãƒ¼ãƒ«</h3>
    {{if eq (len .Queue.Roles) 0}}
      <p class="text-sm text-slate-500">å‰²ã‚Šå½“ã¦æ¸ˆã¿ã®æ‹…å½“è€…ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {{else}}
      <ul class="space-y-2 text-sm text-slate-700">
        {{range .Queue.Roles}}
          <li class="flex items-center justify-between rounded-lg border border-slate-200 px-3 py-2">
            <span class="font-medium text-slate-900">{{.Label}}</span>
            <span class="text-sm text-slate-600">{{.HeadcountLabel}}</span>
          </li>
        {{end}}
      </ul>
    {{end}}
  </div>

  <div class="space-y-3">
    <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©</h3>
    {{if eq (len .Queue.Stages) 0}}
      <p class="text-sm text-slate-500">ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>
    {{else}}
      <ol class="space-y-3 text-sm text-slate-700">
        {{range .Queue.Stages}}
          <li class="rounded-lg border border-slate-200 px-3 py-2">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2 font-medium text-slate-900">
                <span>{{.Label}}</span>
              </div>
              <span class="text-xs text-slate-500">{{.WIPLabel}}</span>
            </div>
            <p class="text-xs text-slate-500">{{.TargetSLALabel}}</p>
            {{if .Description}}<p class="mt-1 text-sm text-slate-600">{{.Description}}</p>{{end}}
          </li>
        {{end}}
      </ol>
    {{end}}
  </div>

  {{if gt (len .Queue.Notes) 0}}
    <div class="space-y-2">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">ãƒ¡ãƒ¢</h3>
      <ul class="list-disc space-y-1 pl-5 text-sm text-slate-600">
        {{range .Queue.Notes}}
          <li>{{.}}</li>
        {{end}}
      </ul>
    </div>
  {{end}}
</div>
{{end}}
