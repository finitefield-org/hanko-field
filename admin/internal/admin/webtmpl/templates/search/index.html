{{define "search/index"}}
{{template "layouts/base" .}}
{{end}}

{{define "search/content"}}
{{$page := .Page}}
<div class="space-y-6" data-search-root>
  <section class="rounded-2xl bg-white px-6 py-6 shadow-sm ring-1 ring-slate-200">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
      <div>
        <h1 class="text-2xl font-semibold text-slate-900">æ¨ªæ–­æ¤œç´¢</h1>
        <p class="mt-2 text-sm text-slate-600">
          æ³¨æ–‡ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ¨ªæ–­ã—ã¦æ¤œç´¢ã—ã€æœ€é©ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ãªã’ã¾ã™ã€‚
        </p>
      </div>
      <div class="flex items-center gap-2">
        {{if $page.AnalyticsBadge}}
          {{template "components/badge" (dict "Label" $page.AnalyticsBadge "Tone" $page.AnalyticsTone)}}
        {{end}}
        <span class="text-xs text-slate-400">ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ : {{$page.Summary.Duration}}</span>
      </div>
    </div>
    <div class="mt-6 border-t border-slate-200 pt-4">
      {{template "search/filter-toolbar" $page}}
    </div>
  </section>

  <div class="grid gap-6 xl:grid-cols-[minmax(0,1fr)_320px]">
    <section class="space-y-4">
      <div
        id="global-search-results"
        data-search-results
        hx-target="this"
        hx-swap="innerHTML"
        class="space-y-4"
      >
        {{template "search/table" $page.TableData}}
      </div>
    </section>

    <aside
      class="hidden min-h-[320px] rounded-2xl border border-slate-200 bg-white p-6 shadow-sm xl:block"
      data-search-detail
    >
      <div data-search-detail-empty>
        <h2 class="text-lg font-semibold text-slate-900">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
        <p class="mt-2 text-sm text-slate-600">çµæœã‚’é¸æŠã™ã‚‹ã¨ã€ã“ã“ã«æ¦‚è¦ã¨æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
      </div>
      <div class="hidden h-full flex-col" data-search-detail-content>
        <div class="flex items-start justify-between gap-3">
          <div>
            <p class="text-xs font-medium uppercase tracking-wide text-slate-500" data-search-detail-entity></p>
            <h2 class="text-lg font-semibold text-slate-900" data-search-detail-title></h2>
          </div>
          <span data-search-detail-badge></span>
        </div>
        <p class="mt-3 text-sm text-slate-600" data-search-detail-description></p>
        <dl class="mt-4 space-y-2 text-sm text-slate-600" data-search-detail-metadata></dl>
        <div class="mt-auto flex flex-wrap gap-3 pt-6">
          <a
            href="#"
            class="{{buttonClass "primary" "sm" false false}}"
            data-search-detail-open="true"
          >
            è©³ç´°ã‚’é–‹ã
          </a>
          <button
            type="button"
            class="{{buttonClass "secondary" "sm" false false}}"
            data-search-detail-copy="true"
          >
            ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼
          </button>
        </div>
      </div>
    </aside>
  </div>
</div>
{{end}}

{{define "search/filter-toolbar"}}
<form
  id="global-search-form"
  data-search-form
  class="flex flex-col gap-4"
  hx-get="{{.TableEndpoint}}"
  hx-trigger="submit"
  hx-target="#global-search-results"
  hx-push-url="true"
  hx-indicator="#global-search-indicator"
>
  <div class="flex flex-col gap-3 md:flex-row md:items-center">
    <div class="relative flex-1">
      <label class="sr-only" for="global-search-input">æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
      <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-slate-400">ğŸ”</span>
      <input
        id="global-search-input"
        name="q"
        type="search"
        placeholder="é¡§å®¢åã€æ³¨æ–‡ç•ªå·ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã§æ¤œç´¢"
        value="{{.Query.Term}}"
        class="w-full rounded-lg border border-slate-300 bg-white py-2 pl-10 pr-4 text-sm text-slate-900 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
        autocomplete="off"
        data-search-input
      />
      <div id="global-search-indicator" class="htmx-indicator absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-400">
        æ¤œç´¢ä¸­â€¦
      </div>
    </div>
    <div class="flex items-center gap-2 md:justify-end">
      <button type="submit" class="{{buttonClass "primary" "sm" false false}}">æ¤œç´¢</button>
      <button type="reset" class="{{buttonClass "secondary" "sm" false false}}" data-search-reset="true">ã‚¯ãƒªã‚¢</button>
    </div>
  </div>

  <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
    <div class="flex flex-wrap gap-2" role="radiogroup" aria-label="æ¤œç´¢å¯¾è±¡">
      {{range $option := .ScopeOptions}}
        <label class="{{searchScopeOptionClass (eq $option.Value $.Query.Scope)}}">
          <input
            type="radio"
            name="scope"
            value="{{$option.Value}}"
            class="sr-only"
            {{if eq $option.Value $.Query.Scope}}checked{{end}}
            data-search-scope
          />
          <span class="flex items-center gap-1 text-sm">
            {{if $option.Icon}}
              <span aria-hidden="true">{{$option.Icon}}</span>
            {{end}}
            {{$option.Label}}
          </span>
        </label>
      {{end}}
    </div>
    <div class="flex flex-wrap gap-3">
      <div class="flex items-center gap-2">
        <label for="search-date-start" class="text-xs font-medium text-slate-500">æœŸé–“</label>
        <input
          id="search-date-start"
          name="start"
          type="date"
          value="{{.Query.StartDate}}"
          class="w-36 rounded-lg border border-slate-300 px-3 py-1 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
          data-search-filter="start"
        />
        <span class="text-sm text-slate-500">ã€œ</span>
        <input
          id="search-date-end"
          name="end"
          type="date"
          value="{{.Query.EndDate}}"
          class="w-36 rounded-lg border border-slate-300 px-3 py-1 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
          data-search-filter="end"
        />
      </div>
      <div class="flex items-center gap-2">
        <label for="search-persona" class="text-xs font-medium text-slate-500">æ‹…å½“</label>
        <select
          id="search-persona"
          name="persona"
          class="w-44 rounded-lg border border-slate-300 px-3 py-1.5 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
          data-search-filter="persona"
        >
          {{range $option := .PersonaOptions}}
            <option value="{{$option.Value}}" {{if eq $option.Value $.Query.Persona}}selected{{end}}>{{$option.Label}}</option>
          {{end}}
        </select>
      </div>
      <input type="hidden" name="limit" value="20" />
    </div>
  </div>
</form>
{{end}}
