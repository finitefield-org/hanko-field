{{define "org/staff-invite-modal"}}
<div class="modal-overlay" data-modal-overlay>
  <div class="modal-panel" data-modal-panel role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description" aria-label="スタッフを招待" tabindex="-1">
    <header class="modal-header">
      <div class="flex-1">
        <h2 id="modal-title" class="modal-title">スタッフを招待</h2>
      </div>
      <button type="button" class="btn btn-ghost btn-sm" data-modal-close>
        <span class="sr-only">閉じる</span>
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" class="h-4 w-4">
          <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
        </svg>
      </button>
    </header>
    <div id="modal-description" class="modal-body">
      <form hx-post="{{.Action}}" hx-target="#modal" hx-swap="innerHTML" class="space-y-5">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
        {{if trimSpace .Error}}
          <div class="rounded-md border border-danger-200 bg-danger-50 px-3 py-2 text-sm text-danger-700">{{.Error}}</div>
        {{end}}
        <div class="space-y-4">
          {{template "org/input-field" (dict "Name" "email" "Label" "メールアドレス" "Type" "email" "Value" .Values.Email "Required" true "Help" "招待メールを送信するアドレスを入力してください。")}}
          {{template "org/input-field" (dict "Name" "name" "Label" "氏名" "Type" "text" "Value" .Values.Name "Required" false "Help" "任意。サイドバーや監査ログに表示されます。")}}
          {{template "org/role-checklist" (dict "Options" .RoleOptions)}}
          {{template "org/textarea-field" (dict "Name" "note" "Label" "監査メモ" "Value" .Values.Note "Help" "変更理由やコンテキストを記録します。監査ログに残ります。")}}
          <label class="flex items-center gap-2 text-sm text-slate-700">
            <input
              type="checkbox"
              name="sendEmail"
              value="1"
              class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-500"
              {{if .Values.SendEmail}}checked{{end}}
            />
            招待メールを送信
          </label>
        </div>
        <div class="flex items-center justify-end gap-3">
          <button type="submit" class="{{buttonClass "primary" "md" false false}}">招待を送信</button>
        </div>
      </form>
    </div>
  </div>
</div>
{{end}}

{{define "org/staff-edit-modal"}}
{{$title := "ロールを更新"}}
{{if trimSpace .MemberName}}
  {{$title = printf "ロールを更新：%s" .MemberName}}
{{end}}
<div class="modal-overlay" data-modal-overlay>
  <div class="modal-panel" data-modal-panel role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description" aria-label="{{$title}}" tabindex="-1">
    <header class="modal-header">
      <div class="flex-1">
        <h2 id="modal-title" class="modal-title">{{$title}}</h2>
      </div>
      <button type="button" class="btn btn-ghost btn-sm" data-modal-close>
        <span class="sr-only">閉じる</span>
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" class="h-4 w-4">
          <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
        </svg>
      </button>
    </header>
    <div id="modal-description" class="modal-body">
      <form hx-post="{{.Action}}" hx-target="#modal" hx-swap="innerHTML" class="space-y-5">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
        {{if trimSpace .Error}}
          <div class="rounded-md border border-danger-200 bg-danger-50 px-3 py-2 text-sm text-danger-700">{{.Error}}</div>
        {{end}}
        {{if trimSpace .MemberEmail}}
          <p class="text-sm text-slate-600">{{.MemberEmail}}</p>
        {{end}}
        {{template "org/role-checklist" (dict "Options" .RoleOptions)}}
        {{template "org/textarea-field" (dict "Name" "note" "Label" "監査メモ" "Value" .Note "Help" "この変更の理由を簡潔に記載してください。")}}
        <div class="flex items-center justify-end gap-3">
          <button type="submit" class="{{buttonClass "primary" "md" false false}}">ロールを保存</button>
        </div>
      </form>
    </div>
  </div>
</div>
{{end}}

{{define "org/staff-revoke-modal"}}
{{$title := "アクセスを停止"}}
{{if trimSpace .MemberName}}
  {{$title = printf "アクセス停止：%s" .MemberName}}
{{end}}
<div class="modal-overlay" data-modal-overlay>
  <div class="modal-panel" data-modal-panel role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description" aria-label="{{$title}}" tabindex="-1">
    <header class="modal-header">
      <div class="flex-1">
        <h2 id="modal-title" class="modal-title">{{$title}}</h2>
      </div>
      <button type="button" class="btn btn-ghost btn-sm" data-modal-close>
        <span class="sr-only">閉じる</span>
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" class="h-4 w-4">
          <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
        </svg>
      </button>
    </header>
    <div id="modal-description" class="modal-body">
      <form hx-post="{{.Action}}" hx-target="#modal" hx-swap="innerHTML" class="space-y-5">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
        {{if trimSpace .Error}}
          <div class="rounded-md border border-danger-200 bg-danger-50 px-3 py-2 text-sm text-danger-700">{{.Error}}</div>
        {{end}}
        {{if trimSpace .MemberEmail}}
          <p class="text-sm text-slate-600">{{.MemberEmail}}</p>
        {{end}}
        {{template "org/input-field" (dict "Name" "reason" "Label" "理由" "Type" "text" "Value" .Reason "Required" true "Help" "監査ログに記録されます。")}}
        {{template "org/textarea-field" (dict "Name" "note" "Label" "追加メモ" "Value" .Note "Help" "任意。サポートチーム向けに補足を残せます。")}}
        <label class="flex items-center gap-2 text-sm text-slate-700">
          <input
            type="checkbox"
            name="revokeSessions"
            value="1"
            class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-500"
            {{if .RevokeSessions}}checked{{end}}
          />
          既存セッションを即時失効させる
        </label>
        <label class="flex items-center gap-2 text-sm text-slate-700">
          <input
            type="checkbox"
            name="notifyUser"
            value="1"
            class="h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-500"
            {{if .NotifyUser}}checked{{end}}
          />
          通知メールを送信
        </label>
        <div class="flex items-center justify-end gap-3">
          <button type="submit" class="{{buttonClass "danger" "md" false false}}">アクセスを停止</button>
        </div>
      </form>
    </div>
  </div>
</div>
{{end}}

{{define "org/input-field"}}
<div class="flex flex-col gap-2">
  <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="{{.Name}}">
    {{.Label}}
    {{if .Required}}<span class="ml-1 text-brand-600">*</span>{{end}}
  </label>
  <input
    id="{{.Name}}"
    name="{{.Name}}"
    type="{{.Type}}"
    value="{{.Value}}"
    class="rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
    {{if .Required}}required{{end}}
  />
  {{if trimSpace .Help}}
    <p class="text-xs text-slate-500">{{.Help}}</p>
  {{end}}
</div>
{{end}}

{{define "org/textarea-field"}}
<div class="flex flex-col gap-2">
  <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="{{.Name}}">{{.Label}}</label>
  <textarea
    id="{{.Name}}"
    name="{{.Name}}"
    rows="3"
    class="rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
  >{{.Value}}</textarea>
  {{if trimSpace .Help}}
    <p class="text-xs text-slate-500">{{.Help}}</p>
  {{end}}
</div>
{{end}}

{{define "org/role-checklist"}}
{{if eq (len .Options) 0}}
  <div class="rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700">選択可能なロールがありません。RBAC 設定を確認してください。</div>
{{else}}
  <fieldset class="space-y-3">
    <legend class="text-xs font-semibold uppercase tracking-wide text-slate-500">ロール</legend>
    {{range $option := .Options}}
      <label class="flex items-start gap-3 rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-700 transition hover:border-brand-300">
        <input
          type="checkbox"
          name="roles"
          value="{{$option.Key}}"
          class="mt-1 h-4 w-4 rounded border-slate-300 text-brand-600 focus:ring-brand-500"
          {{if $option.Checked}}checked{{end}}
        />
        <div>
          <p class="font-medium text-slate-900">{{$option.Label}}</p>
          {{if trimSpace $option.Description}}
            <p class="text-xs text-slate-500">{{$option.Description}}</p>
          {{end}}
        </div>
      </label>
    {{end}}
  </fieldset>
{{end}}
{{end}}
