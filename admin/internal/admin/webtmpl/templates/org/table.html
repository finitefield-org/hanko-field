{{define "org/staff-table"}}
<div
  id="org-staff-table"
  class="rounded-xl border border-slate-200 bg-white shadow-sm"
  data-org-staff-table
  {{if trimSpace .FragmentPath}}hx-get="{{buildURL .FragmentPath .RawQuery}}"{{end}}
  {{if trimSpace .RefreshEvent}}
    hx-trigger="load, {{.RefreshEvent}} from:body"
  {{else}}
    hx-trigger="load"
  {{end}}
  hx-target="this"
  hx-swap="outerHTML"
>
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-200">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">スタッフ</th>
          <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">ロール</th>
          <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">最終アクティブ</th>
          <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">MFA</th>
          <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">ステータス</th>
          <th class="px-3 py-3"></th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 bg-white">
        {{if eq (len .Rows) 0}}
          <tr>
            <td colspan="6" class="px-6 py-12 text-center text-sm text-slate-500">{{fallback .EmptyMessage "条件に一致するスタッフが存在しません。フィルタを調整してください。"}}</td>
          </tr>
        {{else}}
          {{range $row := .Rows}}
            <tr>
              <td class="px-6 py-4 align-top">
                <p class="text-sm font-semibold text-slate-900">{{$row.Name}}</p>
                <p class="text-xs text-slate-500">{{$row.Email}}</p>
                {{if trimSpace $row.InvitationLabel}}
                  <p class="mt-1 text-xs text-amber-600" {{if trimSpace $row.InvitationTooltip}}title="{{$row.InvitationTooltip}}"{{end}}>{{$row.InvitationLabel}}</p>
                {{end}}
              </td>
              <td class="px-6 py-4 align-top">
                {{if eq (len $row.Roles) 0}}
                  <span class="text-xs text-slate-400">未割り当て</span>
                {{else}}
                  <div class="flex flex-wrap gap-2">
                    {{range $badge := $row.Roles}}
                      <span class="inline-flex items-center rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-700">{{$badge.Label}}</span>
                    {{end}}
                  </div>
                {{end}}
              </td>
              <td class="px-6 py-4 align-top text-sm text-slate-600" title="{{$row.LastActiveExact}}">{{$row.LastActiveRelative}}</td>
              <td class="px-6 py-4 align-top">
                {{$mfaClass := "text-xs font-semibold text-slate-600"}}
                {{if not $row.MFAEnabled}}
                  {{$mfaClass = "text-xs font-semibold text-amber-600"}}
                {{end}}
                <span class="{{$mfaClass}}">{{$row.MFAStatus}}</span>
              </td>
              <td class="px-6 py-4 align-top">
                <span class="{{badgeClass $row.StatusTone}}">{{$row.StatusLabel}}</span>
              </td>
              <td class="px-3 py-4 align-top text-right">
                {{if trimSpace $row.Actions.EditURL}}
                  <button
                    type="button"
                    class="{{buttonClass "ghost" "xs" false false}}"
                    hx-get="{{$row.Actions.EditURL}}"
                    hx-target="#modal"
                    hx-swap="innerHTML"
                  >
                    ロールを編集
                  </button>
                {{end}}
                {{if trimSpace $row.Actions.RevokeURL}}
                  <button
                    type="button"
                    class="{{buttonClass "ghost" "xs" false false}}"
                    hx-get="{{$row.Actions.RevokeURL}}"
                    hx-target="#modal"
                    hx-swap="innerHTML"
                  >
                    アクセスを停止
                  </button>
                {{end}}
              </td>
            </tr>
          {{end}}
        {{end}}
      </tbody>
    </table>
  </div>
</div>
{{end}}
