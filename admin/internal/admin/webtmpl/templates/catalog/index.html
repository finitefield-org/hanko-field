{{define "catalog/index"}}
{{template "layouts/base" .}}
{{end}}

{{define "catalog/content"}}
{{$page := .Page}}
<div class="space-y-6" data-catalog-root>
  <section class="rounded-2xl bg-white px-6 py-6 shadow-sm ring-1 ring-slate-200">
    <div class="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
      <div class="space-y-2">
        <p class="text-sm font-semibold uppercase tracking-wide text-slate-500">ã‚«ã‚¿ãƒ­ã‚° / {{$page.KindLabel}}</p>
        <h1 class="text-2xl font-semibold text-slate-900">{{$page.Title}}</h1>
        <p class="text-sm text-slate-600">{{$page.Description}}</p>
        {{if $page.Summary.LastUpdated}}
          <p class="text-xs text-slate-400">æœ€çµ‚æ›´æ–° {{$page.Summary.LastUpdated}}</p>
        {{end}}
      </div>
      <div class="flex flex-1 flex-wrap gap-3 lg:flex-none">
        {{template "catalog/summary-chip" (dict "Label" "ç·æ•°" "Value" $page.Summary.TotalLabel "Classes" "bg-slate-50 text-slate-900")}}
        {{template "catalog/summary-chip" (dict "Label" "å…¬é–‹ä¸­" "Value" $page.Summary.PublishedLabel "Classes" "bg-emerald-50 text-emerald-600")}}
        {{template "catalog/summary-chip" (dict "Label" "å…¬é–‹äºˆç´„" "Value" $page.Summary.ScheduledLabel "Classes" "bg-sky-50 text-sky-600")}}
        {{template "catalog/summary-chip" (dict "Label" "ä¸‹æ›¸ã / ãƒ¬ãƒ“ãƒ¥ãƒ¼" "Value" (printf "%s / %s" $page.Summary.DraftLabel $page.Summary.ReviewLabel) "Classes" "bg-amber-50 text-amber-700")}}
      </div>
      <div class="flex items-center gap-3">
        <button
          type="button"
          class="{{buttonClass "primary" "md" false false}}"
          hx-get="{{$page.CreateURL}}"
          hx-target="#modal"
          hx-swap="innerHTML"
        >
          ã‚¢ã‚»ãƒƒãƒˆã‚’ä½œæˆ
        </button>
      </div>
    </div>
    <div class="mt-6">
      {{template "components/underline-tabs" (dict "Tabs" $page.Tabs)}}
    </div>
  </section>

  <div class="grid gap-6 xl:grid-cols-[minmax(0,1fr)_320px]">
    <section class="space-y-4">
      <div id="catalog-filter-toolbar">
        {{template "catalog/filter-toolbar" $page}}
      </div>
      {{template "catalog/view-toggle" (dict "Toggle" $page.ViewToggle "Swap" false)}}
      {{if eq $page.ViewToggle.Active "cards"}}
        {{template "catalog/cards-section" $page.Cards}}
      {{else}}
        {{template "catalog/table-section" $page.Table}}
      {{end}}
    </section>
    <aside id="catalog-drawer" class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      {{template "catalog/drawer" (dict "Drawer" $page.Drawer "BasePath" $.BasePath)}}
    </aside>
  </div>
</div>
{{end}}

{{define "catalog/summary-chip"}}
<div class="{{classList "flex min-w-[140px] flex-col gap-1 rounded-xl px-4 py-3 text-sm shadow-sm" .Classes}}">
  <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">{{.Label}}</p>
  <p class="text-lg font-semibold">{{.Value}}</p>
</div>
{{end}}

{{define "catalog/filter-toolbar"}}
<section class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <h2 class="text-sm font-semibold text-slate-700">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h2>
    <div class="text-xs text-slate-400" id="catalog-loading">å¾…æ©Ÿä¸­</div>
  </div>
  <form
    class="mt-4 space-y-4"
    method="get"
    hx-get="{{catalogFilterEndpoint .}}"
    hx-target="#catalog-view"
    hx-swap="outerHTML"
    hx-indicator="#catalog-loading"
    hx-push-url="true"
  >
    <input type="hidden" id="catalog-view-field" name="view" value="{{.ViewToggle.Active}}" />
    <div class="flex flex-wrap gap-2" role="group" aria-label="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹">
      {{range $option := .Filters.Statuses}}
        <label class="{{catalogStatusFilterClass $option.Active $option.Tone}}">
          <input type="checkbox" name="status" value="{{$option.Value}}" class="sr-only" {{if $option.Active}}checked{{end}} />
          <span class="text-xs font-semibold">
            {{$option.Label}}
            {{if gt $option.Count 0}}
              <span class="ml-1 text-[11px] text-slate-400">({{$option.Count}})</span>
            {{end}}
          </span>
        </label>
      {{end}}
    </div>

    <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-4">
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="catalog-category">ã‚«ãƒ†ã‚´ãƒª</label>
        <select id="catalog-category" name="category" class="rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
          <option value="">ã™ã¹ã¦</option>
          {{range $option := .Filters.Categories}}
            <option value="{{$option.Value}}" {{if $option.Active}}selected{{end}}>
              {{$option.Label}}
              {{if gt $option.Count 0}}
                {{printf " (%d)" $option.Count}}
              {{end}}
            </option>
          {{end}}
        </select>
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="catalog-owner">æ‹…å½“è€…</label>
        <select id="catalog-owner" name="owner" class="rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
          <option value="">ã™ã¹ã¦</option>
          {{range $option := .Filters.Owners}}
            <option value="{{$option.Value}}" {{if $option.Active}}selected{{end}}>
              {{$option.Label}}
              {{if gt $option.Count 0}}
                {{printf " (%d)" $option.Count}}
              {{end}}
            </option>
          {{end}}
        </select>
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="catalog-tags">ã‚¿ã‚°</label>
        <select
          id="catalog-tags"
          name="tag"
          multiple
          class="min-h-[72px] rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
        >
          {{range $option := .Filters.Tags}}
            <option value="{{$option.Value}}" {{if $option.Active}}selected{{end}}>{{$option.Label}}</option>
          {{end}}
        </select>
        <p class="text-xs text-slate-400">Ctrl/Cmdã‚¯ãƒªãƒƒã‚¯ã§è¤‡æ•°é¸æŠ</p>
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="catalog-updated">æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°</label>
        <select id="catalog-updated" name="updated" class="rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
          <option value="">æŒ‡å®šãªã—</option>
          {{range $option := .Filters.Updated}}
            <option value="{{$option.Value}}" {{if $option.Active}}selected{{end}}>{{$option.Label}}</option>
          {{end}}
        </select>
      </div>
    </div>

    <div class="flex flex-wrap items-center gap-3">
      <div class="flex flex-1 items-center gap-2 rounded-lg border border-slate-300 px-3 py-2 focus-within:ring-2 focus-within:ring-brand-200">
        <span class="text-slate-400">ğŸ”</span>
        <input
          type="search"
          name="q"
          value="{{.Query.Search}}"
          placeholder="ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã€IDã€ã‚¿ã‚°ã§æ¤œç´¢"
          class="flex-1 border-none p-0 text-sm text-slate-900 focus:outline-none"
        />
      </div>
      <button type="submit" class="{{buttonClass "primary" "sm" false false}}">é©ç”¨</button>
      <a href="{{buildURL .PagePath ""}}" class="{{buttonClass "ghost" "sm" false false}}">ãƒªã‚»ãƒƒãƒˆ</a>
    </div>
  </form>
</section>
{{end}}

{{define "catalog/view-toggle"}}
{{$toggle := .Toggle}}
<div
  id="catalog-view-toggle"
  class="flex items-center justify-between rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"
  {{if .Swap}}hx-swap-oob="true"{{end}}
>
  <div>
    <p class="text-sm font-semibold text-slate-700">è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰</p>
    <p class="text-xs text-slate-400">ä¸€è¦§ or ã‚«ãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼</p>
  </div>
  <div class="flex gap-2">
    {{range $option := $toggle.Options}}
      <button
        type="button"
        class="{{catalogViewToggleClass $option.Active}}"
        hx-get="{{$option.Endpoint}}"
        hx-target="#catalog-view"
        hx-swap="outerHTML"
        hx-push-url="{{$option.PushURL}}"
        data-view-toggle="{{$option.Value}}"
      >
        <span>{{$option.Icon}}</span>
        <span>{{$option.Label}}</span>
      </button>
    {{end}}
  </div>
</div>
{{end}}

{{define "catalog/bulk-bar"}}
{{if .Visible}}
  <div class="flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm shadow-sm">
    <p class="font-medium text-slate-700">{{.Summary}}</p>
  </div>
{{end}}
{{end}}
