{{define "catalog/cards-section"}}
<div
  id="catalog-view"
  class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
  hx-target="this"
  hx-swap="outerHTML"
  hx-get="{{buildURL .FragmentPath .RawQuery}}"
  hx-trigger="refresh from:body"
  hx-indicator="#catalog-loading"
>
  {{if eq (len .Cards) 0}}
    <div class="py-12 text-center text-sm text-slate-500">{{.EmptyMessage}}</div>
  {{else}}
    <div class="grid gap-4 md:grid-cols-2">
      {{range $card := .Cards}}
        <article
          class="{{catalogCardClass $card.Selected}}"
          hx-get="{{buildURL $.FragmentPath (setRawQuery $.RawQuery "selected" $card.ID)}}"
          hx-target="#catalog-view"
          hx-swap="outerHTML"
          hx-push-url="{{buildURL $.PagePath (setRawQuery $.RawQuery "selected" $card.ID)}}"
        >
          <div class="flex items-center justify-between gap-3">
            <div class="space-y-1">
              <div class="flex flex-wrap items-center gap-1">
                <h3 class="text-base font-semibold text-slate-900">{{$card.Title}}</h3>
                {{if $card.Version}}
                  <span class="rounded-full bg-slate-100 px-2 py-0.5 text-[11px] font-semibold text-slate-600">{{$card.Version}}</span>
                {{end}}
              </div>
              <p class="text-xs text-slate-500">{{$card.Subtitle}}</p>
              {{if $card.ScheduleLabel}}
                <p class="flex items-center gap-1 text-xs text-slate-500">
                  <span>ðŸ—“</span>
                  <span>{{$card.ScheduleLabel}}</span>
                  {{if $card.ScheduleRelative}}
                    <span class="text-[11px] text-slate-400">({{$card.ScheduleRelative}})</span>
                  {{end}}
                </p>
              {{end}}
              {{if $card.Badge}}
                <span class="{{badgeClass $card.BadgeTone}}">{{$card.Badge}}</span>
              {{end}}
            </div>
            <span class="{{badgeClass $card.StatusTone}}">{{$card.StatusLabel}}</span>
          </div>
          {{if $card.PreviewURL}}
            <img src="{{$card.PreviewURL}}" alt="{{$card.PreviewAlt}}" class="mt-3 h-32 w-full rounded-xl object-cover ring-1 ring-slate-200" />
          {{end}}
          <p class="mt-3 text-sm text-slate-600">{{$card.UsageLabel}}</p>
          <div class="mt-2 flex flex-wrap gap-2 text-xs text-slate-500">
            {{range $metric := $card.Metrics}}
              <span>{{$metric.Icon}} {{$metric.Label}}: {{$metric.Value}}</span>
            {{end}}
          </div>
          <div class="mt-3 flex flex-wrap gap-1 text-[11px] text-slate-500">
            {{range $tag := $card.Tags}}
              <span class="rounded-full bg-slate-100 px-2 py-0.5">{{$tag}}</span>
            {{end}}
          </div>
        </article>
      {{end}}
    </div>
  {{end}}
</div>
<div id="catalog-drawer" hx-swap-oob="true">
  {{template "catalog/drawer" (dict "Drawer" .Drawer "BasePath" $.BasePath)}}
</div>
{{template "catalog/view-toggle" (dict "Toggle" .View "Swap" true)}}
<input type="hidden" id="catalog-view-field" name="view" value="{{.View.Active}}" hx-swap-oob="true" />
{{end}}

{{define "catalog/cards-fragment"}}
{{template "catalog/cards-section" .Page.Cards}}
<div id="catalog-filter-toolbar" hx-swap-oob="true">
  {{template "catalog/filter-toolbar" .Page}}
</div>
{{end}}
