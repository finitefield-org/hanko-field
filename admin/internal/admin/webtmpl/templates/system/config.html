{{define "system/config"}}
{{template "layouts/base" .}}
{{end}}

{{define "system/config-content"}}
{{$page := .Page}}
<div id="top" class="space-y-6" data-environment-settings-root>
  <section class="rounded-2xl bg-white px-6 py-6 shadow-sm ring-1 ring-slate-200">
    <div class="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
      <div class="space-y-3">
        <h1 class="text-2xl font-semibold text-slate-900">{{$page.Title}}</h1>
        <p class="text-sm text-slate-600">{{$page.Description}}</p>
        <div class="flex flex-wrap items-center gap-3 text-sm text-slate-600">
          {{if $page.EnvironmentName}}
            <span class="inline-flex items-center gap-1 rounded-md bg-slate-100 px-3 py-1 text-sm font-medium text-slate-700">
              <span aria-hidden="true">ğŸŒ</span>
              <span>{{$page.EnvironmentName}}</span>
            </span>
          {{end}}
          {{if $page.Region}}
            <span class="inline-flex items-center gap-1 rounded-md bg-slate-100 px-3 py-1 text-sm text-slate-700">
              <span aria-hidden="true">ğŸ“</span>
              <span>{{$page.Region}}</span>
            </span>
          {{end}}
          {{if $page.GeneratedLabel}}
            <span class="inline-flex items-center gap-1 text-xs text-slate-500">
              <span aria-hidden="true">â±</span>
              <span>{{$page.GeneratedLabel}}</span>
            </span>
          {{end}}
        </div>
        {{if $page.Summary}}
          <p class="max-w-3xl text-sm text-slate-700">{{$page.Summary}}</p>
        {{end}}
        {{if $page.Error}}
          <div class="mt-2 rounded-xl border border-rose-300 bg-rose-50 px-4 py-3 text-sm text-rose-900">
            <strong class="font-semibold">å–å¾—ã‚¨ãƒ©ãƒ¼:</strong>
            <span class="ml-1">{{$page.Error}}</span>
          </div>
        {{end}}
        {{if $page.ReadOnly}}
          <div class="mt-2 rounded-xl border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900">
            <strong class="font-semibold">é–²è¦§å°‚ç”¨:</strong>
            <span class="ml-1">æœ¬ç•ªç’°å¢ƒã®è¨­å®šã¯å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚Runbook ã«å¾“ã£ã¦æ¨©é™ç”³è«‹ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</span>
          </div>
        {{end}}
      </div>
      {{if or (gt (len $page.Metadata) 0) (gt (len $page.Documents) 0)}}
        <div class="w-full max-w-sm space-y-4 rounded-xl border border-slate-200 bg-slate-50 p-4">
          {{if gt (len $page.Metadata) 0}}
            <div class="space-y-2">
              <h2 class="text-xs font-semibold uppercase tracking-wide text-slate-500">ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿</h2>
              <dl class="space-y-1">
                {{range $meta := $page.Metadata}}
                  <div class="grid grid-cols-[auto_1fr] gap-2 text-sm">
                    <dt class="text-slate-500">{{$meta.Key}}</dt>
                    <dd class="break-all font-medium text-slate-800">{{$meta.Value}}</dd>
                  </div>
                {{end}}
              </dl>
            </div>
          {{end}}
          {{if gt (len $page.Documents) 0}}
            <div class="space-y-2">
              <h2 class="text-xs font-semibold uppercase tracking-wide text-slate-500">é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h2>
              <ul class="space-y-1 text-sm">
                {{range $doc := $page.Documents}}
                  <li>
                    <a href="{{$doc.URL}}" class="inline-flex items-center gap-2 text-brand-600 hover:text-brand-700 hover:underline">
                      {{if $doc.Icon}}
                        <span aria-hidden="true">{{$doc.Icon}}</span>
                      {{end}}
                      <span>{{$doc.Label}}</span>
                    </a>
                  </li>
                {{end}}
              </ul>
            </div>
          {{end}}
        </div>
      {{end}}
    </div>
  </section>

  <div class="grid gap-6 lg:grid-cols-[220px_minmax(0,1fr)]">
    {{if gt (len $page.Navigation) 0}}
      <nav class="rounded-2xl border border-slate-200 bg-white shadow-sm" aria-label="è¨­å®šã‚«ãƒ†ã‚´ãƒª">
        <ul class="flex flex-col divide-y divide-slate-100">
          {{range $item := $page.Navigation}}
            <li>
              <a href="{{$item.Href}}" class="block px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 hover:text-slate-900">
                {{$item.Title}}
              </a>
            </li>
          {{end}}
        </ul>
      </nav>
    {{else}}
      <div></div>
    {{end}}
    <div class="space-y-6">
      {{range $category := $page.Categories}}
        <section id="{{$category.ID}}" class="rounded-2xl border border-slate-200 bg-white px-6 py-6 shadow-sm">
          <div class="space-y-2">
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
              <h2 class="text-xl font-semibold text-slate-900">{{$category.Title}}</h2>
              <a href="#top" class="hidden text-xs text-slate-400 hover:text-slate-600 sm:inline-flex sm:items-center sm:gap-1">
                <span aria-hidden="true">â¬†</span>
                <span>ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸</span>
              </a>
            </div>
            {{if $category.Description}}
              <p class="text-sm text-slate-600">{{$category.Description}}</p>
            {{end}}
          </div>
          {{if eq (len $category.Items) 0}}
            <p class="mt-4 text-sm text-slate-500">è¨­å®šé …ç›®ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
          {{else}}
            <div class="mt-6 space-y-4">
              {{range $item := $category.Items}}
                <article data-env-setting-item="{{$item.ID}}" class="rounded-xl border border-slate-200 bg-white px-4 py-4 shadow-sm transition hover:border-brand-200">
                  <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
                    <div class="space-y-2">
                      <h3 class="text-base font-semibold text-slate-900">{{$item.Label}}</h3>
                      {{if $item.Description}}
                        <p class="text-sm text-slate-600">{{$item.Description}}</p>
                      {{end}}
                      {{if $item.Locked}}
                        <p class="text-xs text-amber-600">ç·¨é›†ãƒ­ãƒƒã‚¯: {{systemFallbackLockReason $item.LockedReason}}</p>
                      {{end}}
                      {{if $item.Sensitive}}
                        <span class="inline-flex items-center gap-1 rounded-md bg-rose-100 px-2 py-0.5 text-xs font-semibold text-rose-700">
                          <span aria-hidden="true">ğŸ”’</span>
                          <span>ç§˜åŒ¿æƒ…å ±</span>
                        </span>
                      {{end}}
                      {{if gt (len $item.Tags) 0}}
                        <div class="flex flex-wrap gap-2">
                          {{range $tag := $item.Tags}}
                            <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-600">#{{$tag}}</span>
                          {{end}}
                        </div>
                      {{end}}
                      {{if gt (len $item.Docs) 0}}
                        <ul class="space-y-1 text-sm">
                          {{range $link := $item.Docs}}
                            <li>
                              <a href="{{$link.URL}}" class="inline-flex items-center gap-2 text-brand-600 hover:text-brand-700 hover:underline">
                                {{if $link.Icon}}
                                  <span aria-hidden="true">{{$link.Icon}}</span>
                                {{end}}
                                <span>{{$link.Label}}</span>
                              </a>
                            </li>
                          {{end}}
                        </ul>
                      {{end}}
                    </div>
                    <div class="flex min-w-[180px] flex-col items-start gap-2 text-sm text-slate-600 sm:items-end">
                      {{if $item.StatusLabel}}
                        <span class="{{badgeClass $item.StatusTone}}">{{$item.StatusLabel}}</span>
                      {{end}}
                      {{if $item.Value}}
                        <p class="text-base font-semibold text-slate-900 text-right">{{$item.Value}}</p>
                      {{end}}
                      {{if $item.ValueHint}}
                        <p class="text-xs text-slate-500 text-right">{{$item.ValueHint}}</p>
                      {{end}}
                    </div>
                  </div>
                </article>
              {{end}}
            </div>
          {{end}}
        </section>
      {{end}}

      {{if gt (len $page.AuditTrail) 0}}
        <section id="environment-change-log" class="rounded-2xl border border-slate-200 bg-white px-6 py-6 shadow-sm">
          <div class="space-y-3">
            <h2 class="text-xl font-semibold text-slate-900">æœ€è¿‘ã®å¤‰æ›´å±¥æ­´</h2>
            <ul class="space-y-4">
              {{range $entry := $page.AuditTrail}}
                <li class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-4">
                  <div class="flex flex-col gap-2">
                    <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                      <div class="flex flex-wrap items-center gap-2">
                        <span class="text-sm font-semibold text-slate-900">{{$entry.Actor}}</span>
                        {{if $entry.Action}}
                          <span class="text-xs uppercase tracking-wide text-slate-500">{{$entry.Action}}</span>
                        {{end}}
                      </div>
                      <div class="text-xs text-slate-500">
                        <span>{{$entry.Timestamp}}</span>
                        {{if $entry.Relative}}
                          <span class="ml-2 text-slate-400">({{$entry.Relative}})</span>
                        {{end}}
                      </div>
                    </div>
                    {{if $entry.Summary}}
                      <p class="text-sm text-slate-700">{{$entry.Summary}}</p>
                    {{end}}
                    {{if gt (len $entry.Changes) 0}}
                      <table class="mt-2 min-w-full divide-y divide-slate-200 text-left text-xs text-slate-600">
                        <thead class="bg-slate-100 text-slate-500">
                          <tr>
                            <th scope="col" class="px-3 py-2 font-medium">é …ç›®</th>
                            <th scope="col" class="px-3 py-2 font-medium">Before</th>
                            <th scope="col" class="px-3 py-2 font-medium">After</th>
                          </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100 bg-white">
                          {{range $change := $entry.Changes}}
                            <tr>
                              <td class="px-3 py-2">{{$change.Key}}</td>
                              <td class="px-3 py-2">{{$change.Before}}</td>
                              <td class="px-3 py-2">{{$change.After}}</td>
                            </tr>
                          {{end}}
                        </tbody>
                      </table>
                    {{end}}
                  </div>
                </li>
              {{end}}
            </ul>
          </div>
        </section>
      {{end}}
    </div>
  </div>
</div>
{{end}}
