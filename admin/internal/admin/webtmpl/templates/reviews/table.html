{{define "reviews/table-section"}}
<div class="divide-y divide-slate-200">
  <header class="flex items-center justify-between gap-3 px-5 py-4">
    <div>
      <h2 class="text-base font-semibold text-slate-900">„É¨„Éì„É•„Éº‰∏ÄË¶ß</h2>
      {{if .Table.LastUpdated}}
        <p class="text-xs text-slate-500">
          Êõ¥Êñ∞ {{.Table.LastUpdated}}
          {{if .Table.LastRelative}}
            <span> ({{.Table.LastRelative}})</span>
          {{end}}
        </p>
      {{end}}
    </div>
    {{if .Table.Error}}
      <span class="text-sm font-medium text-rose-600">{{.Table.Error}}</span>
    {{else if .Table.Pagination.Info.TotalItems}}
      <span class="text-xs text-slate-400">ÂÖ® {{intValue .Table.Pagination.Info.TotalItems}} ‰ª∂</span>
    {{else}}
      <span class="text-xs text-slate-400">„Éö„Éº„Ç∏ {{printf "%d" .Table.Pagination.Info.Current}}</span>
    {{end}}
  </header>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-200 text-sm">
      <thead class="bg-slate-50">
        <tr>
          <th scope="col" class="px-5 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">„É¨„Éì„É•„Éº</th>
          <th scope="col" class="px-5 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">È°ßÂÆ¢</th>
          <th scope="col" class="px-5 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">ÂïÜÂìÅ</th>
          <th scope="col" class="px-5 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">„ÉÅ„É£„Éç„É´</th>
          <th scope="col" class="px-5 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">„Éï„É©„Ç∞</th>
          <th scope="col" class="px-5 py-3 text-right text-xs font-semibold uppercase tracking-wide text-slate-500">ÊèêÂá∫</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100 bg-white">
        {{if eq (len .Table.Rows) 0}}
          <tr>
            <td colspan="6" class="px-5 py-6 text-center text-sm text-slate-500">
              {{if .Table.Error}}
                {{.Table.Error}}
              {{else if .Table.EmptyMessage}}
                {{.Table.EmptyMessage}}
              {{else}}
                „É¨„Éì„É•„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
              {{end}}
            </td>
          </tr>
        {{else}}
          {{range $row := .Table.Rows}}
            <tr
              class="{{reviewsTableRowClass $row.Selected}}"
              hx-get="{{$row.SelectURL}}"
              hx-target="#reviews-table"
              hx-swap="outerHTML"
              hx-push-url="true"
            >
              <td class="px-5 py-4 align-top">
                <div class="flex flex-col gap-1">
                  <div class="flex items-center gap-2">
                    {{template "reviews/rating-stars" $row.Rating}}
                    <span class="text-xs text-slate-400">{{$row.RatingLabel}}</span>
                  </div>
                  <p class="font-semibold text-slate-900">{{$row.Title}}</p>
                  <p class="text-sm text-slate-600">{{$row.Excerpt}}</p>
                  <div class="flex items-center gap-2 text-xs text-slate-400">
                    {{if gt $row.AttachmentsCount 0}}
                      <span>üìé {{printf "%d‰ª∂" $row.AttachmentsCount}}</span>
                    {{end}}
                    {{if $row.Reported}}
                      <span>üö© ÈÄöÂ†±„ÅÇ„Çä</span>
                    {{end}}
                  </div>
                </div>
              </td>
              <td class="px-5 py-4 align-top">
                <div class="flex items-center gap-3">
                  {{if $row.CustomerAvatar}}
                    <img src="{{$row.CustomerAvatar}}" alt="{{printf "%s„ÅÆÂÜôÁúü" $row.CustomerName}}" class="h-9 w-9 rounded-full ring-2 ring-white" />
                  {{else}}
                    <div class="flex h-9 w-9 items-center justify-center rounded-full bg-slate-200 text-xs font-semibold text-slate-600">üë§</div>
                  {{end}}
                  <div class="flex flex-col">
                    <span class="font-medium text-slate-900">{{$row.CustomerName}}</span>
                    {{if $row.CustomerLocation}}
                      <span class="text-xs text-slate-500">{{$row.CustomerLocation}}</span>
                    {{end}}
                  </div>
                </div>
              </td>
              <td class="px-5 py-4 align-top">
                <div class="flex items-center gap-3">
                  {{if $row.ProductImage}}
                    <img src="{{$row.ProductImage}}" alt="{{$row.ProductName}}" class="h-12 w-12 rounded-md border border-slate-200 object-cover" />
                  {{end}}
                  <div class="flex flex-col">
                    <a href="{{$row.ProductURL}}" class="text-sm font-medium text-brand-600 hover:underline">{{$row.ProductName}}</a>
                    {{if $row.ProductVariant}}
                      <span class="text-xs text-slate-500">{{$row.ProductVariant}}</span>
                    {{end}}
                    <span class="text-xs text-slate-400">Ê≥®Êñá #{{$row.OrderNumber}}</span>
                  </div>
                </div>
              </td>
              <td class="px-5 py-4 align-top">
                <div class="{{reviewsChannelBadgeClass $row.ChannelTone}}">
                  {{if $row.ChannelIcon}}<span aria-hidden="true" class="mr-1">{{$row.ChannelIcon}}</span>{{end}}
                  {{$row.ChannelLabel}}
                </div>
              </td>
              <td class="px-5 py-4 align-top">
                <div class="flex flex-wrap gap-1.5">
                  {{if eq (len $row.Flags) 0}}
                    <span class="text-xs text-slate-400">Ôºç</span>
                  {{else}}
                    {{range $flag := $row.Flags}}
                      <span class="{{reviewsFlagBadgeClass $flag.Tone}}" {{if $flag.Tooltip}}title="{{$flag.Tooltip}}"{{end}}>
                        {{if $flag.Icon}}<span aria-hidden="true" class="mr-1">{{$flag.Icon}}</span>{{end}}
                        {{$flag.Label}}
                      </span>
                    {{end}}
                  {{end}}
                </div>
              </td>
              <td class="px-5 py-4 text-right align-top">
                <div class="flex flex-col items-end gap-1">
                  <span class="text-sm font-medium text-slate-900">{{$row.SubmittedRelative}}</span>
                  <span class="text-xs text-slate-400">{{$row.SubmittedAt}}</span>
                  <span class="{{reviewsModerationBadgeClass $row.ModerationTone}}">{{$row.ModerationLabel}}</span>
                </div>
              </td>
            </tr>
          {{end}}
        {{end}}
      </tbody>
    </table>
  </div>

  <footer class="px-5 py-4">
    {{template "components/pagination" .Pagination}}
  </footer>
</div>
{{end}}

{{define "reviews/table-fragment"}}
{{template "reviews/table-section" .Table}}
<div id="reviews-detail" hx-swap-oob="true">
  {{template "reviews/detail" .Detail}}
</div>
{{end}}

{{define "reviews/rating-stars"}}
<div class="flex items-center gap-0.5 text-amber-500">
  {{range $i := starIndices}}
    {{if lt $i .}}
      <span aria-hidden="true">‚òÖ</span>
    {{else}}
      <span aria-hidden="true" class="text-slate-300">‚òÖ</span>
    {{end}}
  {{end}}
</div>
{{end}}
