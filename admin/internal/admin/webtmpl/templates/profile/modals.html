{{define "profile/totp-modal"}}
{{$data := .Data}}
<div class="modal-overlay" data-modal-overlay>
  <div class="modal-panel" data-modal-panel role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description" aria-label="Authenticator を設定" tabindex="-1">
    <header class="modal-header">
      <div class="flex-1">
        <h2 id="modal-title" class="modal-title">Authenticator を設定</h2>
      </div>
      <button type="button" class="btn btn-ghost btn-sm" data-modal-close>
        <span class="sr-only">閉じる</span>
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" class="h-4 w-4">
          <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
        </svg>
      </button>
    </header>
    <div id="modal-description" class="modal-body">
      {{if not $data.Enrollment}}
        <p class="text-sm text-slate-600">MFA 登録情報を取得できませんでした。しばらくしてから再試行してください。</p>
      {{else}}
        <div class="space-y-4 text-sm text-slate-700">
          <p>Authenticator アプリ (Google Authenticator、1Password など) で QR コードを読み取り、表示された 6 桁コードを入力してください。</p>
          {{if $data.Enrollment.QRCodePNG}}
            <img src="{{$data.Enrollment.QRCodePNG}}" alt="QRコード" class="mx-auto h-44 w-44 rounded-lg border border-slate-200" />
          {{end}}
          <div class="rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 font-mono text-sm">
            {{$data.Enrollment.Secret}}
          </div>
          <form
            hx-post="{{joinBase $.BasePath "/profile/mfa/totp"}}"
            hx-target="#modal"
            hx-swap="innerHTML"
            class="space-y-3"
          >
            <input type="hidden" name="csrf_token" value="{{$data.CSRFToken}}" />
            {{template "components/text-input" (dict "ID" "code" "Name" "code" "Label" "6 桁コード" "Placeholder" "123456" "Required" true "AutoFocus" true)}}
            {{if $data.Error}}
              <p class="text-sm text-rose-600">{{$data.Error}}</p>
            {{end}}
            <button type="submit" class="{{buttonClass "primary" "md" true false}}">有効化する</button>
          </form>
          <p class="text-xs text-slate-500">復旧コードを安全な場所に保管し、デバイス喪失時に備えてください。</p>
        </div>
      {{end}}
    </div>
  </div>
</div>
{{end}}

{{define "profile/api-key-form-modal"}}
{{$data := .Data}}
<div class="modal-overlay" data-modal-overlay>
  <div class="modal-panel" data-modal-panel role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description" aria-label="API キーを発行" tabindex="-1">
    <header class="modal-header">
      <div class="flex-1">
        <h2 id="modal-title" class="modal-title">API キーを発行</h2>
      </div>
      <button type="button" class="btn btn-ghost btn-sm" data-modal-close>
        <span class="sr-only">閉じる</span>
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" class="h-4 w-4">
          <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
        </svg>
      </button>
    </header>
    <div id="modal-description" class="modal-body">
      <form
        hx-post="{{joinBase $.BasePath "/profile/api-keys"}}"
        hx-target="#modal"
        hx-swap="innerHTML"
        class="space-y-4"
      >
        <input type="hidden" name="csrf_token" value="{{$data.CSRFToken}}" />
        {{template "components/text-input" (dict "ID" "label" "Name" "label" "Label" "ラベル" "Placeholder" "例: Zapier Integration" "Required" true "Value" $data.Label)}}
        {{if $data.Error}}
          <p class="text-sm text-rose-600">{{$data.Error}}</p>
        {{end}}
        <button type="submit" class="{{buttonClass "primary" "md" true false}}">キーを発行</button>
      </form>
      <p class="mt-3 text-xs text-slate-500">※ キーは暗号化して保存されるため、シークレットはこの画面でのみ表示されます。</p>
    </div>
  </div>
</div>
{{end}}

{{define "profile/api-key-secret-modal"}}
{{$secret := .Secret}}
{{if $secret}}
  <div class="modal-overlay" data-modal-overlay>
    <div class="modal-panel" data-modal-panel role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description" aria-label="API キー発行" tabindex="-1">
      <header class="modal-header">
        <div class="flex-1">
          <h2 id="modal-title" class="modal-title">API キー発行</h2>
        </div>
        <button type="button" class="btn btn-ghost btn-sm" data-modal-close>
          <span class="sr-only">閉じる</span>
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" class="h-4 w-4">
            <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
          </svg>
        </button>
      </header>
      <div id="modal-description" class="modal-body">
        <div class="space-y-4 text-sm text-slate-700">
          {{if .Message}}
            <p class="rounded-lg border border-sky-200 bg-sky-50 px-3 py-2 text-sky-900">{{.Message}}</p>
          {{end}}
          <div>
            <h3 class="text-sm font-semibold text-slate-800">シークレット</h3>
            <p class="mt-2 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 font-mono text-sm">{{$secret.Secret}}</p>
          </div>
          <p class="text-xs text-slate-500">シークレットはコピーして安全な場所に保管してください。</p>
          <button type="button" class="w-full rounded-lg border border-slate-300 px-4 py-2 text-sm text-slate-600 hover:bg-slate-100" data-modal-close>閉じる</button>
        </div>
      </div>
    </div>
  </div>
{{end}}
{{end}}
