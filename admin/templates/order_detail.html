<article class="flex flex-col gap-5 p-4 sm:p-5">
  <header>
    <h3 class="text-xl leading-tight font-bold">{{ detail.order_no }}</h3>
    <p class="mt-1 text-xs font-semibold tracking-[0.06em] text-admin-muted uppercase">更新: {{ detail.updated_at }}</p>
  </header>

  {% if detail.has_message %}
  <p class="rounded-xl border border-admin-accent/30 bg-admin-accent-soft px-3 py-2 text-sm font-semibold text-admin-accent">{{ detail.message }}</p>
  {% endif %}
  {% if detail.has_error %}
  <p class="rounded-xl border border-admin-alert/35 bg-[rgb(157_47_36_/_0.08)] px-3 py-2 text-sm font-semibold text-admin-alert">{{ detail.error }}</p>
  {% endif %}

  <dl class="grid gap-2 rounded-xl border border-admin-line/70 bg-admin-bg/40 p-3 text-sm sm:grid-cols-2">
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">注文日時</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.created_at }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">ステータス</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.status_label }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">支払い</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.payment_status_label }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">配送進捗</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.fulfillment_status_label }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">チャネル</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.channel }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">ロケール</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.locale }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">配送国</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.country_label }} ({{ detail.country_code }})</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">Email</dt>
      <dd class="mt-1 text-[0.92rem] break-all">{{ detail.contact_email }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">印面</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.seal_line1 }}{% if detail.has_seal_line2 %} / {{ detail.seal_line2 }}{% endif %}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">材質</dt>
      <dd class="mt-1 text-[0.92rem]">{{ detail.material_label_ja }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">合計</dt>
      <dd class="mt-1 text-[0.92rem] font-semibold">¥{{ detail.total_jpy }}</dd>
    </div>
    <div class="rounded-lg border border-admin-line/50 bg-white px-3 py-2">
      <dt class="text-[0.7rem] font-bold tracking-[0.07em] text-admin-muted uppercase">追跡番号</dt>
      <dd class="mt-1 text-[0.92rem]">{% if detail.has_tracking_no %}{{ detail.tracking_no }}{% else %}-{% endif %}</dd>
    </div>
  </dl>

  <section class="rounded-xl border border-admin-line/70 bg-white p-4">
    <h4 class="text-base font-bold">ステータス更新</h4>
    {% if detail.has_next_statuses %}
    <form
      class="mt-3 flex flex-col gap-3"
      hx-patch="/admin/orders/{{ detail.id }}/status"
      hx-target="#order-detail"
      hx-swap="innerHTML"
    >
      <label class="flex flex-col gap-1.5 text-sm font-semibold">
        <span>次ステータス</span>
        <select name="next_status" required>
          <option value="">選択してください</option>
          {% for option in detail.next_statuses %}
          <option value="{{ option.value }}">{{ option.label }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="flex flex-col gap-1.5 text-sm font-semibold">
        <span>実行者ID</span>
        <input type="text" name="actor_id" value="admin.console">
      </label>
      <button type="submit" class="w-fit rounded-[10px] border border-admin-accent bg-admin-accent px-4 py-[10px] text-[0.92rem] font-semibold text-white transition hover:brightness-[1.05]">ステータス反映</button>
    </form>
    {% else %}
    <p class="mt-2 text-sm font-semibold text-admin-muted">この注文はこれ以上ステータス遷移できません。</p>
    {% endif %}
  </section>

  <section class="rounded-xl border border-admin-line/70 bg-white p-4">
    <h4 class="text-base font-bold">出荷情報更新</h4>
    <form
      class="mt-3 flex flex-col gap-3"
      hx-patch="/admin/orders/{{ detail.id }}/shipping"
      hx-target="#order-detail"
      hx-swap="innerHTML"
    >
      <label class="flex flex-col gap-1.5 text-sm font-semibold">
        <span>配送業者</span>
        <input type="text" name="carrier" value="{{ detail.carrier }}" placeholder="ヤマト運輸 / DHL など" required>
      </label>
      <label class="flex flex-col gap-1.5 text-sm font-semibold">
        <span>追跡番号</span>
        <input type="text" name="tracking_no" value="{{ detail.tracking_no }}" required>
      </label>
      <label class="flex flex-col gap-1.5 text-sm font-semibold">
        <span>ステータス遷移</span>
        <select name="shipping_transition">
          {% for option in detail.shipping_transitions %}
          <option value="{{ option.value }}">{{ option.label }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="flex flex-col gap-1.5 text-sm font-semibold">
        <span>実行者ID</span>
        <input type="text" name="actor_id" value="admin.console">
      </label>
      <button type="submit" class="w-fit rounded-[10px] border border-admin-accent bg-admin-accent px-4 py-[10px] text-[0.92rem] font-semibold text-white transition hover:brightness-[1.05]">出荷情報を保存</button>
    </form>
  </section>

  <section class="rounded-xl border border-admin-line/70 bg-white p-4">
    <h4 class="text-base font-bold">監査イベント</h4>
    <ul class="mt-3 flex flex-col gap-2.5">
      {% for event in detail.events %}
      <li class="rounded-lg border border-admin-line/55 bg-admin-bg/40 px-3 py-2.5">
        <p class="flex flex-wrap items-center justify-between gap-2">
          <strong>{{ event.kind }}</strong>
          <span class="text-xs font-semibold text-admin-muted">{{ event.created_at }}</span>
        </p>
        <p class="mt-1 text-sm text-admin-muted">actor: {{ event.actor_type }}{% if event.has_actor_id %} / {{ event.actor_id }}{% endif %}</p>
        {% if event.has_before_status %}
        <p class="mt-1 text-sm text-admin-muted">{{ event.before_status_label }} → {{ event.after_status_label }}</p>
        {% endif %}
        {% if event.has_note %}
        <p class="mt-1 text-sm text-admin-muted">{{ event.note }}</p>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  </section>
</article>
