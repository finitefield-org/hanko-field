fail_fast: true

pre-commit:
  parallel: true
  commands:
    # --- åŸºæœ¬ãƒã‚§ãƒƒã‚¯ ---
    check-merge-conflict-app:
      run: |
        echo "ğŸ” Checking for merge conflict markers..."
        if git grep -n "<<<<<<< HEAD" -- app/ >/dev/null 2>&1; then
          echo "âŒ Merge conflict marker found."
          git grep -n "<<<<<<< HEAD" -- app/
          exit 1
        fi
    check-merge-conflict-api:
      run: |
        echo "ğŸ” Checking for merge conflict markers..."
        if git grep -n "<<<<<<< HEAD" -- api/ >/dev/null 2>&1; then
          echo "âŒ Merge conflict marker found."
          git grep -n "<<<<<<< HEAD" -- api/
          exit 1
        fi
    check-merge-conflict-admin:
      run: |
        echo "ğŸ” Checking for merge conflict markers..."
        if git grep -n "<<<<<<< HEAD" -- admin/ >/dev/null 2>&1; then
          echo "âŒ Merge conflict marker found."
          git grep -n "<<<<<<< HEAD" -- admin/
          exit 1
        fi
    check-merge-conflict-web:
      run: |
        echo "ğŸ” Checking for merge conflict markers..."
        if git grep -n "<<<<<<< HEAD" -- web/ >/dev/null 2>&1; then
          echo "âŒ Merge conflict marker found."
          git grep -n "<<<<<<< HEAD" -- web/
          exit 1
        fi

    # --- Dart/Flutter ãƒã‚§ãƒƒã‚¯ ---

    dart-format:
      run: |
        echo "ğŸ¯ Running dart format..."
        dart format app/
      stage_fixed: true
      glob: "app/**/*.dart"

    flutter-analyze:
      run: |
        echo "ğŸ§  Running flutter analyze..."
        cd app && flutter analyze
      glob: "app/**/*.dart"

    flutter-test:
      run: |
        echo "ğŸ§ª Running flutter tests..."
        cd app && flutter test --no-pub
      glob: "app/**/*.dart"

    # --- Go (api/admin) ãƒã‚§ãƒƒã‚¯ ---

    gofmt-api:
      run: |
        echo "ğŸ§¹ Running gofmt for api..."
        for file in {staged_files}; do
          gofmt -w "$file"
        done
      stage_fixed: true
      glob: "api/**/*.go"

    go-test-api:
      run: |
        echo "âœ… Running go test (api)..."
        cd api && go test ./...
      glob: "api/**/*"

    gofmt-admin:
      run: |
        echo "ğŸ§¹ Running gofmt for admin..."
        for file in {staged_files}; do
          gofmt -w "$file"
        done
      stage_fixed: true
      glob: "admin/**/*.go"

    go-test-admin:
      run: |
        echo "âœ… Running go test (admin)..."
        cd admin && go test ./...
      glob: "admin/**/*"

    gofmt-web:
      run: |
        echo "ğŸ§¹ Running gofmt for web..."
        for file in {staged_files}; do
          gofmt -w "$file"
        done
      stage_fixed: true
      glob: "web/**/*.go"

    go-test-web:
      run: |
        echo "âœ… Running go test (web)..."
        cd web && go test ./...
      glob: "web/**/*"
