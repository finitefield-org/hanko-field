services:
  workspace:
    build: .
    volumes:
      - .:/workspace:cached
    ports:
      - "8080:8080"
    environment:
      - GOOGLE_CLOUD_PROJECT=hanko-field-dev
      - FIRESTORE_EMULATOR_HOST=firebase:8081
      - API_FIRESTORE_EMULATOR_HOST=firebase:8081
      - FIREBASE_AUTH_EMULATOR_HOST=firebase:9099
      - FIRESTORE_PROJECT_ID=hanko-field-dev
      - API_FIREBASE_PROJECT_ID=hanko-field-dev
      - API_FIRESTORE_PROJECT_ID=hanko-field-dev
      - API_STORAGE_ASSETS_BUCKET=local-assets
      - ADMIN_ALLOW_INSECURE_AUTH=1
    depends_on:
      - firebase
    command: sleep infinity

  firebase:
    build: .
    volumes:
      - .:/workspace:cached
    ports:
      - "4000:4000"
      - "8081:8081"
      - "9099:9099"
    command: >
      bash -c "
        devbox run -- npx -y firebase-tools emulators:start --project=hanko-field-dev --import=./firebase-data --export-on-exit=./firebase-data
      "
